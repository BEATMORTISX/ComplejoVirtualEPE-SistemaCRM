<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complejo Virtual EPE - Sistema CRM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* ===== VARIABLES Y RESET ===== */
        :root {
            --primary-color: #000000;
            --secondary-color: #2c3e50;
            --accent-color: #34495e;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #3498db;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --gray-color: #95a5a6;
            --border-color: #bdc3c7;
            --bg-color: #1a1a1a;
            --card-color: #2d2d2d;
            --text-color: #ffffff;
            --text-secondary: #b0b0b0;
            
            --gradient-primary: linear-gradient(135deg, #000000, #2c3e50);
            --gradient-secondary: linear-gradient(135deg, #2c3e50, #34495e);
            --gradient-success: linear-gradient(135deg, #27ae60, #2ecc71);
            --gradient-warning: linear-gradient(135deg, #f39c12, #f1c40f);
            --gradient-danger: linear-gradient(135deg, #e74c3c, #c0392b);
            --gradient-info: linear-gradient(135deg, #3498db, #2980b9);
            
            --radius: 8px;
            --radius-lg: 12px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.5);
            
            --sidebar-width: 280px;
            --header-height: 70px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* ===== BOTONES ===== */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-secondary {
            background: var(--gradient-secondary);
            color: white;
            box-shadow: var(--shadow);
        }
        
        .btn-success {
            background: var(--gradient-success);
            color: white;
            box-shadow: var(--shadow);
        }
        
        .btn-warning {
            background: var(--gradient-warning);
            color: white;
            box-shadow: var(--shadow);
        }
        
        .btn-danger {
            background: var(--gradient-danger);
            color: white;
            box-shadow: var(--shadow);
        }
        
        .btn-info {
            background: var(--gradient-info);
            color: white;
            box-shadow: var(--shadow);
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }
        
        .btn-lg {
            padding: 12px 24px;
            font-size: 1.1rem;
        }
        
        /* ===== LAYOUT GENERAL ===== */
        .hidden {
            display: none !important;
        }
        
        /* ===== LOGIN SCREEN ===== */
        #login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient-primary);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .login-card {
            background: var(--card-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 450px;
            overflow: hidden;
            animation: slideUp 0.6s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo-section {
            background: var(--gradient-primary);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
        }
        
        .logo-placeholder {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2rem;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .institution-name {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            color: white;
        }
        
        .system-title {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        
        .connection-mode-selector {
            display: flex;
            gap: 10px;
            margin: 15px auto;
            max-width: 300px;
        }
        
        .connection-mode-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .connection-mode-btn.active {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--info-color);
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }
        
        /* ===== FORMULARIOS ===== */
        #login-form {
            padding: 2rem;
        }
        
        .form-group {
            margin-bottom: 1.2rem;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.9rem;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px 12px 40px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-color);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--info-color);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .input-icon {
            position: absolute;
            left: 15px;
            top: 40px;
            color: var(--gray-color);
            z-index: 1;
        }
        
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 40px;
            background: none;
            border: none;
            color: var(--gray-color);
            cursor: pointer;
            z-index: 1;
        }
        
        /* ===== DASHBOARD LAYOUT ===== */
        .dashboard-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: var(--bg-color);
        }
        
        .dashboard-header {
            background: var(--card-color);
            box-shadow: var(--shadow);
            padding: 0 1.5rem;
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 2px solid var(--secondary-color);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo-mini {
            font-size: 1.8rem;
            color: var(--info-color);
        }
        
        .header-title h1 {
            margin: 0;
            font-size: 1.5rem;
            color: white;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: var(--radius);
            border-left: 3px solid var(--info-color);
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .user-details h4 {
            margin: 0;
            font-size: 1rem;
            color: white;
        }
        
        .user-details small {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }
        
        /* ===== SIDEBAR ===== */
        .dashboard-content {
            display: flex;
            flex: 1;
        }
        
        .dashboard-nav {
            width: var(--sidebar-width);
            background: var(--card-color);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.5rem 0;
            position: sticky;
            top: var(--header-height);
            height: calc(100vh - var(--header-height));
            overflow-y: auto;
        }
        
        .nav-section {
            margin-bottom: 2rem;
            padding: 0 1rem;
        }
        
        .nav-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            color: var(--gray-color);
            margin-bottom: 0.8rem;
            font-weight: 600;
            letter-spacing: 1px;
            padding-left: 8px;
            border-left: 2px solid var(--info-color);
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: var(--text-color);
            text-decoration: none;
            border-radius: var(--radius);
            margin-bottom: 6px;
            transition: all 0.3s;
            cursor: pointer;
            border-left: 2px solid transparent;
        }
        
        .nav-item:hover {
            background: rgba(52, 152, 219, 0.1);
            border-left-color: var(--info-color);
        }
        
        .nav-item.active {
            background: rgba(52, 152, 219, 0.2);
            color: white;
            border-left-color: var(--info-color);
        }
        
        .nav-item i {
            width: 20px;
            text-align: center;
            color: var(--info-color);
        }
        
        /* ===== CONTENIDO PRINCIPAL ===== */
        .content-area {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background: var(--bg-color);
        }
        
        .content-section {
            animation: fadeIn 0.5s ease-out;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* ===== TARJETAS ===== */
        .card {
            background: var(--card-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--info-color);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* ===== TABLAS ===== */
        .table-responsive {
            overflow-x: auto;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-color);
        }
        
        th {
            background: var(--gradient-primary);
            color: white;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            vertical-align: middle;
            color: var(--text-color);
        }
        
        tr:hover {
            background: rgba(52, 152, 219, 0.05);
        }
        
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-success {
            background: var(--gradient-success);
            color: white;
        }
        
        .badge-warning {
            background: var(--gradient-warning);
            color: white;
        }
        
        .badge-danger {
            background: var(--gradient-danger);
            color: white;
        }
        
        .badge-info {
            background: var(--gradient-info);
            color: white;
        }
        
        /* ===== ESTADÍSTICAS ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            background: var(--card-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s;
            border-top: 3px solid var(--info-color);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            box-shadow: var(--shadow);
        }
        
        .stat-info h3 {
            margin: 0;
            font-size: 2rem;
            color: white;
        }
        
        .stat-info p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        /* ===== MODALES ===== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: var(--card-color);
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: modalIn 0.4s ease-out;
        }
        
        .modal-header {
            padding: 1.2rem 1.5rem;
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            padding: 1.2rem 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .close-modal {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ===== ALERTAS ===== */
        #alert-container {
            position: fixed;
            top: 80px;
            right: 15px;
            z-index: 3000;
            max-width: 350px;
        }
        
        .alert {
            background: var(--card-color);
            border-radius: var(--radius);
            padding: 1rem 1.2rem;
            margin-bottom: 10px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideInRight 0.3s ease-out;
            border-left: 4px solid var(--primary-color);
        }
        
        .alert-success {
            border-left-color: var(--success-color);
        }
        
        .alert-error {
            border-left-color: var(--danger-color);
        }
        
        .alert-warning {
            border-left-color: var(--warning-color);
        }
        
        .alert-info {
            border-left-color: var(--info-color);
        }
        
        /* ===== CONEXIÓN STATUS ===== */
        .connection-status {
            position: fixed;
            bottom: 15px;
            right: 15px;
            z-index: 1000;
            padding: 10px 15px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            box-shadow: var(--shadow-lg);
            color: white;
        }
        
        .connection-online {
            background: var(--gradient-success);
        }
        
        .connection-offline {
            background: var(--gradient-danger);
        }
        
        /* ===== CARD ID ===== */
        .carnet-container {
            width: 204px; /* 5.4cm */
            height: 325px; /* 8.6cm */
            background: white;
            border-radius: 10px;
            padding: 15px;
            position: relative;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin: 0 auto;
        }
        
        .carnet-header {
            background: var(--gradient-primary);
            color: white;
            padding: 10px;
            border-radius: 8px 8px 0 0;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .carnet-photo {
            width: 80px;
            height: 100px;
            background: #f0f0f0;
            border: 2px solid #ddd;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        
        .carnet-info {
            font-size: 11px;
            color: #333;
            margin-bottom: 5px;
        }
        
        .carnet-qr {
            position: absolute;
            bottom: 15px;
            right: 15px;
            width: 60px;
            height: 60px;
        }
        
        /* ===== ANIMACIONES ===== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes modalIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {
            .dashboard-nav {
                width: 70px;
                padding: 1rem 0;
            }
            
            .nav-title,
            .nav-item span:last-child {
                display: none;
            }
            
            .nav-item {
                justify-content: center;
                padding: 12px;
            }
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-header {
                padding: 0 1rem;
            }
            
            .content-area {
                padding: 1rem;
            }
            
            .card {
                padding: 1rem;
            }
        }
        
        /* ===== UTILIDADES ===== */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        .gap-3 { gap: 1.5rem; }
        .w-full { width: 100%; }
        
        /* ===== FORM GRID ===== */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        /* ===== THEME SELECTOR ===== */
        .theme-selector {
            position: fixed;
            bottom: 15px;
            left: 15px;
            z-index: 1000;
        }
        
        .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid white;
            cursor: pointer;
            margin-bottom: 5px;
        }
        
        .theme-blue-white {
            background: linear-gradient(45deg, #3498db, #ffffff);
        }
        
        .theme-green-black {
            background: linear-gradient(45deg, #27ae60, #000000);
        }
        
        .theme-red-gray {
            background: linear-gradient(45deg, #e74c3c, #95a5a6);
        }
    </style>
</head>
<body>
    <!-- ===== CONEXIÓN STATUS ===== -->
    <div id="connection-status" class="connection-status connection-offline">
        <i class="fas fa-wifi-slash"></i>
        <span>Modo Offline</span>
    </div>
    
    <!-- ===== ALERTAS ===== -->
    <div id="alert-container"></div>
    
    <!-- ===== THEME SELECTOR ===== -->
    <div class="theme-selector hidden" id="theme-selector">
        <div class="theme-btn theme-blue-white" onclick="cambiarTema('blue-white')"></div>
        <div class="theme-btn theme-green-black" onclick="cambiarTema('green-black')"></div>
        <div class="theme-btn theme-red-gray" onclick="cambiarTema('red-gray')"></div>
    </div>

    <!-- ===== PANTALLA DE LOGIN ===== -->
    <div id="login-container">
        <div class="login-card">
            <div class="logo-section">
                <div class="logo-placeholder">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <h1 class="institution-name">Complejo Virtual EPE</h1>
                <div class="system-title">
                    <i class="fas fa-cogs"></i> SISTEMA CRM EDUCATIVO
                </div>
                
                <div class="connection-mode-selector">
                    <div class="connection-mode-btn active" data-mode="online">
                        <i class="fas fa-wifi"></i> Online
                    </div>
                    <div class="connection-mode-btn" data-mode="offline">
                        <i class="fas fa-wifi-slash"></i> Offline
                    </div>
                </div>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">
                        <i class="fas fa-user"></i> Usuario
                    </label>
                    <input type="text" id="username" class="form-control" placeholder="Ingrese su usuario" required>
                    <div class="input-icon">
                        <i class="fas fa-user"></i>
                    </div>
                </div>
                <div class="form-group">
                    <label for="password">
                        <i class="fas fa-lock"></i> Contraseña
                    </label>
                    <input type="password" id="password" class="form-control" placeholder="Ingrese su contraseña" required>
                    <div class="input-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <button type="button" class="password-toggle" id="toggle-password">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <div class="form-group">
                    <label for="role">
                        <i class="fas fa-user-tag"></i> Tipo de Usuario
                    </label>
                    <select id="role" class="form-control" required>
                        <option value="">Seleccione un rol</option>
                        <option value="admin">Administrador</option>
                        <option value="plantel">Plantel</option>
                        <option value="director">Director</option>
                        <option value="docente">Docente</option>
                        <option value="participante">Participante</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary w-full">
                    <i class="fas fa-sign-in-alt"></i>
                    Iniciar Sesión
                </button>
                <div class="login-footer text-center mt-3">
                    <p><i class="fas fa-shield-alt"></i> Sistema Seguro | Acceso Restringido</p>
                    <p class="version">Versión 4.0.0 | © 2024 Complejo Virtual EPE</p>
                </div>
            </form>
        </div>
    </div>

    <!-- ===== DASHBOARD ADMINISTRADOR ===== -->
    <div id="admin-dashboard" class="dashboard-container hidden">
        <div class="dashboard-header">
            <div class="header-left">
                <div class="logo-mini">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div class="header-title">
                    <h1>Panel de Administración</h1>
                </div>
            </div>
            <div class="header-right">
                <a href="https://github.com/BEATMORTISX/ComplejoVirtualEPE-SistemaCRM.git" target="_blank" class="github-btn hidden" id="github-btn-admin">
                    <i class="fab fa-github"></i> GitHub
                </a>
                <button id="repair-system-btn" class="btn btn-warning">
                    <i class="fas fa-tools"></i> Reparar Sistema
                </button>
                <button class="btn btn-info" onclick="toggleThemeSelector()">
                    <i class="fas fa-palette"></i> Apariencia
                </button>
                <div class="user-info">
                    <div class="user-avatar" id="admin-avatar">A</div>
                    <div class="user-details">
                        <h4 id="admin-name">Administrador</h4>
                        <small>Administrador</small>
                    </div>
                </div>
                <button id="logout-btn" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt"></i> Salir
                </button>
            </div>
        </div>
        
        <div class="dashboard-content">
            <nav class="dashboard-nav">
                <div class="nav-section">
                    <div class="nav-title">Principal</div>
                    <div class="nav-item active" data-section="dashboard">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </div>
                    <div class="nav-item" data-section="mi-perfil">
                        <i class="fas fa-user"></i>
                        <span>Mi Perfil</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">Gestión</div>
                    <div class="nav-item" data-section="planteles">
                        <i class="fas fa-school"></i>
                        <span>Planteles</span>
                    </div>
                    <div class="nav-item" data-section="directores">
                        <i class="fas fa-user-tie"></i>
                        <span>Directores</span>
                    </div>
                    <div class="nav-item" data-section="docentes">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <span>Docentes</span>
                    </div>
                    <div class="nav-item" data-section="participantes">
                        <i class="fas fa-users"></i>
                        <span>Participantes</span>
                    </div>
                    <div class="nav-item" data-section="formaciones">
                        <i class="fas fa-book-open"></i>
                        <span>Formaciones</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">Sistema</div>
                    <div class="nav-item" data-section="usuarios">
                        <i class="fas fa-user-cog"></i>
                        <span>Usuarios</span>
                    </div>
                    <div class="nav-item" data-section="configuracion">
                        <i class="fas fa-cog"></i>
                        <span>Configuración</span>
                    </div>
                    <div class="nav-item" data-section="reportes">
                        <i class="fas fa-file-alt"></i>
                        <span>Reportes</span>
                    </div>
                    <div class="nav-item" id="sync-now-btn">
                        <i class="fas fa-sync-alt"></i>
                        <span>Sincronizar</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">Acceso Rápido</div>
                    <div class="nav-item" onclick="accederInterfaz('plantel')">
                        <i class="fas fa-school"></i>
                        <span>Ver Plantel</span>
                    </div>
                    <div class="nav-item" onclick="accederInterfaz('director')">
                        <i class="fas fa-user-tie"></i>
                        <span>Ver Director</span>
                    </div>
                    <div class="nav-item" onclick="accederInterfaz('docente')">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <span>Ver Docente</span>
                    </div>
                    <div class="nav-item" onclick="accederInterfaz('participante')">
                        <i class="fas fa-user-graduate"></i>
                        <span>Ver Participante</span>
                    </div>
                </div>
            </nav>
            
            <main class="content-area">
                <!-- Dashboard Principal -->
                <div id="section-dashboard" class="content-section">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-primary);">
                                <i class="fas fa-school"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-planteles">0</h3>
                                <p>Planteles</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-secondary);">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-participantes">0</h3>
                                <p>Participantes</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-warning);">
                                <i class="fas fa-chalkboard-teacher"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-docentes">0</h3>
                                <p>Docentes</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-danger);">
                                <i class="fas fa-book-open"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-formaciones">0</h3>
                                <p>Formaciones</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Acciones Rápidas</h3>
                        </div>
                        <div class="flex gap-2 flex-wrap">
                            <button class="btn btn-primary" onclick="openModal('modal-plantel')">
                                <i class="fas fa-plus"></i> Nuevo Plantel
                            </button>
                            <button class="btn btn-primary" onclick="openModal('modal-usuario')">
                                <i class="fas fa-plus"></i> Nuevo Usuario
                            </button>
                            <button class="btn btn-primary" onclick="openModal('modal-docente')">
                                <i class="fas fa-plus"></i> Nuevo Docente
                            </button>
                            <button class="btn btn-primary" onclick="openModal('modal-formacion')">
                                <i class="fas fa-plus"></i> Nueva Formación
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Mi Perfil -->
                <div id="section-mi-perfil" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Mi Perfil - Administrador</h3>
                        </div>
                        <form id="form-perfil-admin">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Nombre Completo</label>
                                    <input type="text" id="admin-profile-name" class="form-control" value="Administrador Principal">
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" id="admin-profile-email" class="form-control" value="pabloemiliorico24@gmail.com">
                                </div>
                                <div class="form-group">
                                    <label>Contraseña Actual</label>
                                    <input type="password" id="admin-current-password" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>Nueva Contraseña</label>
                                    <input type="password" id="admin-new-password" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>Confirmar Contraseña</label>
                                    <input type="password" id="admin-confirm-password" class="form-control">
                                </div>
                            </div>
                            <button type="button" class="btn btn-success mt-3" onclick="guardarPerfilAdmin()">
                                <i class="fas fa-save"></i> Guardar Cambios
                            </button>
                        </form>
                    </div>
                </div>
                
                <!-- Gestión de Planteles -->
                <div id="section-planteles" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Gestión de Planteles</h3>
                            <button class="btn btn-primary" onclick="openModal('modal-plantel')">
                                <i class="fas fa-plus"></i> Nuevo Plantel
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table id="tabla-planteles">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Código Dependencia</th>
                                        <th>Código Plantel</th>
                                        <th>Nombre</th>
                                        <th>Ciudad</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Los datos se cargan dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Gestión de Directores -->
                <div id="section-directores" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Gestión de Directores</h3>
                            <button class="btn btn-primary" onclick="openModal('modal-director')">
                                <i class="fas fa-plus"></i> Nuevo Director
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table id="tabla-directores">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Cédula</th>
                                        <th>Nombre</th>
                                        <th>Email</th>
                                        <th>Plantel</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Los datos se cargan dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Gestión de Docentes -->
                <div id="section-docentes" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Gestión de Docentes</h3>
                            <button class="btn btn-primary" onclick="openModal('modal-docente')">
                                <i class="fas fa-plus"></i> Nuevo Docente
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table id="tabla-docentes">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Cédula</th>
                                        <th>Nombre</th>
                                        <th>Especialidad</th>
                                        <th>Email</th>
                                        <th>Plantel</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Los datos se cargan dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Gestión de Participantes -->
                <div id="section-participantes" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Gestión de Participantes</h3>
                            <button class="btn btn-primary" onclick="openModal('modal-participante')">
                                <i class="fas fa-plus"></i> Nuevo Participante
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table id="tabla-participantes">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Cédula</th>
                                        <th>Nombre</th>
                                        <th>Edad</th>
                                        <th>Email</th>
                                        <th>Formación</th>
                                        <th>Plantel</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Los datos se cargan dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Gestión de Formaciones -->
                <div id="section-formaciones" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Gestión de Formaciones</h3>
                            <button class="btn btn-primary" onclick="openModal('modal-formacion')">
                                <i class="fas fa-plus"></i> Nueva Formación
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table id="tabla-formaciones">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Código</th>
                                        <th>Nombre</th>
                                        <th>Duración</th>
                                        <th>Modalidad</th>
                                        <th>Docente</th>
                                        <th>Plantel</th>
                                        <th>Vacantes</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Los datos se cargan dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Gestión de Usuarios -->
                <div id="section-usuarios" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Gestión de Usuarios</h3>
                            <button class="btn btn-primary" onclick="openModal('modal-usuario')">
                                <i class="fas fa-plus"></i> Nuevo Usuario
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table id="tabla-usuarios">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Usuario</th>
                                        <th>Nombre</th>
                                        <th>Rol</th>
                                        <th>Email</th>
                                        <th>Entidad</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Los datos se cargan dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Configuración -->
                <div id="section-configuracion" class="content-section hidden">
                    <div class="card">
                        <h3>Configuración del Sistema</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Intervalo de Sincronización (segundos)</label>
                                <input type="number" id="intervalo-sincronizacion" value="5" min="1" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Frecuencia de Backup</label>
                                <select id="frecuencia-backup" class="form-control">
                                    <option value="daily">Diario</option>
                                    <option value="weekly">Semanal</option>
                                    <option value="monthly">Mensual</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex gap-2 mt-3">
                            <button class="btn btn-primary" onclick="guardarConfiguracion()">
                                <i class="fas fa-save"></i> Guardar
                            </button>
                            <button class="btn btn-info" onclick="crearBackup()">
                                <i class="fas fa-download"></i> Crear Backup
                            </button>
                            <button class="btn btn-warning" onclick="cargarVersionAnterior()">
                                <i class="fas fa-history"></i> Cargar Versión Anterior
                            </button>
                        </div>
                    </div>
                    
                    <div class="card mt-3">
                        <h3>Actualización desde GitHub</h3>
                        <div class="flex gap-2">
                            <button class="btn btn-success" onclick="actualizarDesdeGitHub()">
                                <i class="fas fa-sync-alt"></i> Actualizar Sistema
                            </button>
                            <button class="btn btn-info" onclick="sincronizarGitHub()">
                                <i class="fab fa-github"></i> Sincronizar con GitHub
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Reportes -->
                <div id="section-reportes" class="content-section hidden">
                    <div class="card">
                        <h3>Generación de Reportes</h3>
                        <div class="flex gap-2 flex-wrap">
                            <button class="btn btn-primary" onclick="generarReportePDF('planteles')">
                                <i class="fas fa-file-pdf"></i> Planteles (PDF)
                            </button>
                            <button class="btn btn-success" onclick="generarReporteExcel('participantes')">
                                <i class="fas fa-file-excel"></i> Participantes (Excel)
                            </button>
                            <button class="btn btn-info" onclick="generarCarnetParticipante()">
                                <i class="fas fa-id-card"></i> Carnet Participante
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- ===== DASHBOARD PLANTEL ===== -->
    <div id="plantel-dashboard" class="dashboard-container hidden">
        <div class="dashboard-header">
            <div class="header-left">
                <div class="logo-mini">
                    <i class="fas fa-school"></i>
                </div>
                <div class="header-title">
                    <h1>Panel de Plantel</h1>
                </div>
            </div>
            <div class="header-right">
                <button class="btn btn-info" onclick="toggleThemeSelector()">
                    <i class="fas fa-palette"></i> Apariencia
                </button>
                <div class="user-info">
                    <div class="user-avatar" id="plantel-avatar">P</div>
                    <div class="user-details">
                        <h4 id="plantel-name">Plantel</h4>
                        <small>Plantel</small>
                    </div>
                </div>
                <button id="logout-btn-plantel" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt"></i> Salir
                </button>
            </div>
        </div>
        
        <div class="dashboard-content">
            <nav class="dashboard-nav">
                <div class="nav-section">
                    <div class="nav-title">Principal</div>
                    <div class="nav-item active" data-section="dashboard-plantel">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </div>
                    <div class="nav-item" data-section="mi-perfil-plantel">
                        <i class="fas fa-user"></i>
                        <span>Mi Perfil</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">Gestión</div>
                    <div class="nav-item" data-section="docentes-plantel">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <span>Docentes</span>
                    </div>
                    <div class="nav-item" data-section="participantes-plantel">
                        <i class="fas fa-users"></i>
                        <span>Participantes</span>
                    </div>
                    <div class="nav-item" data-section="formaciones-plantel">
                        <i class="fas fa-book-open"></i>
                        <span>Formaciones</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">Acciones</div>
                    <div class="nav-item" onclick="openModal('modal-docente')">
                        <i class="fas fa-plus"></i>
                        <span>Nuevo Docente</span>
                    </div>
                    <div class="nav-item" onclick="openModal('modal-participante')">
                        <i class="fas fa-plus"></i>
                        <span>Nuevo Participante</span>
                    </div>
                    <div class="nav-item" onclick="openModal('modal-formacion')">
                        <i class="fas fa-plus"></i>
                        <span>Nueva Formación</span>
                    </div>
                </div>
            </nav>
            
            <main class="content-area">
                <!-- Dashboard Plantel -->
                <div id="section-dashboard-plantel" class="content-section">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-secondary);">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-directores-plantel">0</h3>
                                <p>Directores</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-warning);">
                                <i class="fas fa-chalkboard-teacher"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-docentes-plantel">0</h3>
                                <p>Docentes</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-primary);">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-participantes-plantel">0</h3>
                                <p>Participantes</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-danger);">
                                <i class="fas fa-book-open"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-formaciones-plantel">0</h3>
                                <p>Formaciones</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Información del Plantel</h3>
                        <div id="info-plantel-detalle">
                            <!-- Se carga dinámicamente -->
                        </div>
                    </div>
                </div>
                
                <!-- Mi Perfil Plantel -->
                <div id="section-mi-perfil-plantel" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Mi Perfil - Plantel</h3>
                        </div>
                        <div id="perfil-plantel-detalle">
                            <!-- Se carga dinámicamente -->
                        </div>
                    </div>
                </div>
                
                <!-- Docentes del Plantel -->
                <div id="section-docentes-plantel" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Docentes del Plantel</h3>
                            <button class="btn btn-primary" onclick="openModal('modal-docente')">
                                <i class="fas fa-plus"></i> Nuevo Docente
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table id="tabla-docentes-plantel">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Cédula</th>
                                        <th>Nombre</th>
                                        <th>Especialidad</th>
                                        <th>Email</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Se carga dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Participantes del Plantel -->
                <div id="section-participantes-plantel" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Participantes del Plantel</h3>
                            <button class="btn btn-primary" onclick="openModal('modal-participante')">
                                <i class="fas fa-plus"></i> Nuevo Participante
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table id="tabla-participantes-plantel">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Cédula</th>
                                        <th>Nombre</th>
                                        <th>Edad</th>
                                        <th>Email</th>
                                        <th>Formación</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Se carga dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Formaciones del Plantel -->
                <div id="section-formaciones-plantel" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Formaciones del Plantel</h3>
                            <button class="btn btn-primary" onclick="openModal('modal-formacion')">
                                <i class="fas fa-plus"></i> Nueva Formación
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table id="tabla-formaciones-plantel">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Código</th>
                                        <th>Nombre</th>
                                        <th>Duración</th>
                                        <th>Modalidad</th>
                                        <th>Docente</th>
                                        <th>Vacantes</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Se carga dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- ===== DASHBOARD DIRECTOR ===== -->
    <div id="director-dashboard" class="dashboard-container hidden">
        <div class="dashboard-header">
            <div class="header-left">
                <div class="logo-mini">
                    <i class="fas fa-user-tie"></i>
                </div>
                <div class="header-title">
                    <h1>Panel de Director</h1>
                </div>
            </div>
            <div class="header-right">
                <button class="btn btn-info" onclick="toggleThemeSelector()">
                    <i class="fas fa-palette"></i> Apariencia
                </button>
                <div class="user-info">
                    <div class="user-avatar" id="director-avatar">D</div>
                    <div class="user-details">
                        <h4 id="director-name">Director</h4>
                        <small>Director</small>
                    </div>
                </div>
                <button id="logout-btn-director" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt"></i> Salir
                </button>
            </div>
        </div>
        
        <div class="dashboard-content">
            <nav class="dashboard-nav">
                <div class="nav-section">
                    <div class="nav-title">Principal</div>
                    <div class="nav-item active" data-section="dashboard-director">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </div>
                    <div class="nav-item" data-section="mi-perfil-director">
                        <i class="fas fa-user"></i>
                        <span>Mi Perfil</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">Gestión</div>
                    <div class="nav-item" data-section="docentes-director">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <span>Docentes</span>
                    </div>
                    <div class="nav-item" data-section="participantes-director">
                        <i class="fas fa-users"></i>
                        <span>Participantes</span>
                    </div>
                    <div class="nav-item" data-section="formaciones-director">
                        <i class="fas fa-book-open"></i>
                        <span>Formaciones</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">Acciones</div>
                    <div class="nav-item" onclick="openModal('modal-docente')">
                        <i class="fas fa-plus"></i>
                        <span>Nuevo Docente</span>
                    </div>
                    <div class="nav-item" onclick="openModal('modal-participante')">
                        <i class="fas fa-plus"></i>
                        <span>Nuevo Participante</span>
                    </div>
                    <div class="nav-item" onclick="openModal('modal-formacion')">
                        <i class="fas fa-plus"></i>
                        <span>Nueva Formación</span>
                    </div>
                </div>
            </nav>
            
            <main class="content-area">
                <!-- Dashboard Director -->
                <div id="section-dashboard-director" class="content-section">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-warning);">
                                <i class="fas fa-chalkboard-teacher"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-docentes-director">0</h3>
                                <p>Docentes</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-primary);">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-participantes-director">0</h3>
                                <p>Participantes</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-danger);">
                                <i class="fas fa-book-open"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-formaciones-director">0</h3>
                                <p>Formaciones</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Información del Director</h3>
                        <div id="info-director-detalle">
                            <!-- Se carga dinámicamente -->
                        </div>
                    </div>
                </div>
                
                <!-- Mi Perfil Director -->
                <div id="section-mi-perfil-director" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Mi Perfil - Director</h3>
                        </div>
                        <div id="perfil-director-detalle">
                            <!-- Se carga dinámicamente -->
                        </div>
                    </div>
                </div>
                
                <!-- Docentes del Director -->
                <div id="section-docentes-director" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Docentes del Plantel</h3>
                            <button class="btn btn-primary" onclick="openModal('modal-docente')">
                                <i class="fas fa-plus"></i> Nuevo Docente
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table id="tabla-docentes-director">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Cédula</th>
                                        <th>Nombre</th>
                                        <th>Especialidad</th>
                                        <th>Email</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Se carga dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Participantes del Director -->
                <div id="section-participantes-director" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Participantes del Plantel</h3>
                            <button class="btn btn-primary" onclick="openModal('modal-participante')">
                                <i class="fas fa-plus"></i> Nuevo Participante
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table id="tabla-participantes-director">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Cédula</th>
                                        <th>Nombre</th>
                                        <th>Edad</th>
                                        <th>Email</th>
                                        <th>Formación</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Se carga dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Formaciones del Director -->
                <div id="section-formaciones-director" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Formaciones del Plantel</h3>
                            <button class="btn btn-primary" onclick="openModal('modal-formacion')">
                                <i class="fas fa-plus"></i> Nueva Formación
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table id="tabla-formaciones-director">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Código</th>
                                        <th>Nombre</th>
                                        <th>Duración</th>
                                        <th>Modalidad</th>
                                        <th>Docente</th>
                                        <th>Vacantes</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Se carga dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- ===== DASHBOARD DOCENTE ===== -->
    <div id="docente-dashboard" class="dashboard-container hidden">
        <div class="dashboard-header">
            <div class="header-left">
                <div class="logo-mini">
                    <i class="fas fa-chalkboard-teacher"></i>
                </div>
                <div class="header-title">
                    <h1>Panel de Docente</h1>
                </div>
            </div>
            <div class="header-right">
                <button class="btn btn-info" onclick="toggleThemeSelector()">
                    <i class="fas fa-palette"></i> Apariencia
                </button>
                <div class="user-info">
                    <div class="user-avatar" id="docente-avatar">D</div>
                    <div class="user-details">
                        <h4 id="docente-name">Docente</h4>
                        <small>Docente</small>
                    </div>
                </div>
                <button id="logout-btn-docente" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt"></i> Salir
                </button>
            </div>
        </div>
        
        <div class="dashboard-content">
            <nav class="dashboard-nav">
                <div class="nav-section">
                    <div class="nav-title">Principal</div>
                    <div class="nav-item active" data-section="dashboard-docente">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </div>
                    <div class="nav-item" data-section="mi-perfil-docente">
                        <i class="fas fa-user"></i>
                        <span>Mi Perfil</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">Gestión</div>
                    <div class="nav-item" data-section="formaciones-docente">
                        <i class="fas fa-book-open"></i>
                        <span>Mis Formaciones</span>
                    </div>
                    <div class="nav-item" data-section="participantes-docente">
                        <i class="fas fa-users"></i>
                        <span>Mis Participantes</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">Acciones</div>
                    <div class="nav-item" onclick="openModal('modal-participante')">
                        <i class="fas fa-plus"></i>
                        <span>Añadir Participante</span>
                    </div>
                </div>
            </nav>
            
            <main class="content-area">
                <!-- Dashboard Docente -->
                <div id="section-dashboard-docente" class="content-section">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-danger);">
                                <i class="fas fa-book-open"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-formaciones-docente">0</h3>
                                <p>Formaciones</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-primary);">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-participantes-docente">0</h3>
                                <p>Participantes</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Información del Docente</h3>
                        <div id="info-docente-detalle">
                            <!-- Se carga dinámicamente -->
                        </div>
                    </div>
                </div>
                
                <!-- Mi Perfil Docente -->
                <div id="section-mi-perfil-docente" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Mi Perfil - Docente</h3>
                        </div>
                        <div id="perfil-docente-detalle">
                            <!-- Se carga dinámicamente -->
                        </div>
                    </div>
                </div>
                
                <!-- Formaciones del Docente -->
                <div id="section-formaciones-docente" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Mis Formaciones</h3>
                        </div>
                        <div class="table-responsive">
                            <table id="tabla-formaciones-docente">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Código</th>
                                        <th>Nombre</th>
                                        <th>Duración</th>
                                        <th>Modalidad</th>
                                        <th>Vacantes</th>
                                        <th>Participantes</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Se carga dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Participantes del Docente -->
                <div id="section-participantes-docente" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Mis Participantes</h3>
                            <button class="btn btn-primary" onclick="openModal('modal-participante')">
                                <i class="fas fa-plus"></i> Añadir Participante
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table id="tabla-participantes-docente">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Cédula</th>
                                        <th>Nombre</th>
                                        <th>Edad</th>
                                        <th>Email</th>
                                        <th>Formación</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Se carga dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- ===== DASHBOARD PARTICIPANTE ===== -->
    <div id="participante-dashboard" class="dashboard-container hidden">
        <div class="dashboard-header">
            <div class="header-left">
                <div class="logo-mini">
                    <i class="fas fa-user-graduate"></i>
                </div>
                <div class="header-title">
                    <h1>Panel de Participante</h1>
                </div>
            </div>
            <div class="header-right">
                <button class="btn btn-info" onclick="toggleThemeSelector()">
                    <i class="fas fa-palette"></i> Apariencia
                </button>
                <div class="user-info">
                    <div class="user-avatar" id="participante-avatar">P</div>
                    <div class="user-details">
                        <h4 id="participante-name">Participante</h4>
                        <small>Participante</small>
                    </div>
                </div>
                <button id="logout-btn-participante" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt"></i> Salir
                </button>
            </div>
        </div>
        
        <div class="dashboard-content">
            <nav class="dashboard-nav">
                <div class="nav-section">
                    <div class="nav-title">Principal</div>
                    <div class="nav-item active" data-section="dashboard-participante">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </div>
                    <div class="nav-item" data-section="mi-perfil-participante">
                        <i class="fas fa-user"></i>
                        <span>Mi Perfil</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">Formaciones</div>
                    <div class="nav-item" data-section="mis-formaciones">
                        <i class="fas fa-book-open"></i>
                        <span>Mis Formaciones</span>
                    </div>
                    <div class="nav-item" data-section="inscribirse-formacion">
                        <i class="fas fa-pen-alt"></i>
                        <span>Inscribirse a Nueva Formación</span>
                    </div>
                </div>
            </nav>
            
            <main class="content-area">
                <!-- Dashboard Participante -->
                <div id="section-dashboard-participante" class="content-section">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-danger);">
                                <i class="fas fa-book-open"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-mis-formaciones">0</h3>
                                <p>Formaciones Inscritas</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-success);">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="stat-formaciones-disponibles">0</h3>
                                <p>Formaciones Disponibles</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Mi Información</h3>
                        <div id="info-participante-detalle">
                            <!-- Se carga dinámicamente -->
                        </div>
                    </div>
                </div>
                
                <!-- Mi Perfil Participante -->
                <div id="section-mi-perfil-participante" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Mi Perfil - Participante</h3>
                        </div>
                        <div id="perfil-participante-detalle">
                            <!-- Se carga dinámicamente -->
                        </div>
                    </div>
                </div>
                
                <!-- Mis Formaciones -->
                <div id="section-mis-formaciones" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Mis Formaciones</h3>
                        </div>
                        <div class="table-responsive">
                            <table id="tabla-mis-formaciones">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Código</th>
                                        <th>Nombre</th>
                                        <th>Duración</th>
                                        <th>Modalidad</th>
                                        <th>Docente</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Se carga dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Inscribirse a Formación -->
                <div id="section-inscribirse-formacion" class="content-section hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Inscribirse a Nueva Formación</h3>
                        </div>
                        <div class="form-group mb-3">
                            <label>Seleccionar Plantel</label>
                            <select id="select-plantel-inscripcion" class="form-control" onchange="cargarFormacionesPorPlantel()">
                                <option value="">Seleccionar Plantel</option>
                            </select>
                        </div>
                        <div class="table-responsive">
                            <table id="tabla-formaciones-disponibles">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Código</th>
                                        <th>Nombre</th>
                                        <th>Duración</th>
                                        <th>Modalidad</th>
                                        <th>Docente</th>
                                        <th>Vacantes</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Se carga dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- ===== MODALES ===== -->
    
    <!-- Modal para Nuevo Plantel -->
    <div id="modal-plantel" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nuevo Plantel</h3>
                <button class="close-modal" onclick="closeModal('modal-plantel')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-plantel">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Código de Dependencia *</label>
                            <input type="text" id="plantel-codigo-dependencia" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Código de Plantel *</label>
                            <input type="text" id="plantel-codigo-plantel" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Nombre del Plantel *</label>
                            <input type="text" id="plantel-nombre" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Dirección *</label>
                            <input type="text" id="plantel-direccion" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Ciudad *</label>
                            <input type="text" id="plantel-ciudad" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Teléfono</label>
                            <input type="tel" id="plantel-telefono" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="plantel-email" class="form-control">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-plantel')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarPlantel()">Guardar Plantel</button>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Plantel -->
    <div id="modal-editar-plantel" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Plantel</h3>
                <button class="close-modal" onclick="closeModal('modal-editar-plantel')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-editar-plantel">
                    <input type="hidden" id="editar-plantel-id">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Código de Dependencia *</label>
                            <input type="text" id="editar-plantel-codigo-dependencia" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Código de Plantel *</label>
                            <input type="text" id="editar-plantel-codigo-plantel" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Nombre del Plantel *</label>
                            <input type="text" id="editar-plantel-nombre" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Dirección *</label>
                            <input type="text" id="editar-plantel-direccion" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Ciudad *</label>
                            <input type="text" id="editar-plantel-ciudad" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Teléfono</label>
                            <input type="tel" id="editar-plantel-telefono" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="editar-plantel-email" class="form-control">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-editar-plantel')">Cancelar</button>
                <button class="btn btn-primary" onclick="actualizarPlantel()">Actualizar Plantel</button>
            </div>
        </div>
    </div>

    <!-- Modal para Nuevo Director -->
    <div id="modal-director" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nuevo Director</h3>
                <button class="close-modal" onclick="closeModal('modal-director')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-director">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Cédula *</label>
                            <input type="text" id="director-cedula" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Nombres *</label>
                            <input type="text" id="director-nombres" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Apellidos *</label>
                            <input type="text" id="director-apellidos" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Teléfono *</label>
                            <input type="tel" id="director-telefono" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="director-email" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Plantel Asignado *</label>
                            <select id="director-plantel" class="form-control" required>
                                <option value="">Seleccione un plantel</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-director')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarDirector()">Guardar Director</button>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Director -->
    <div id="modal-editar-director" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Director</h3>
                <button class="close-modal" onclick="closeModal('modal-editar-director')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-editar-director">
                    <input type="hidden" id="editar-director-id">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Cédula *</label>
                            <input type="text" id="editar-director-cedula" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Nombres *</label>
                            <input type="text" id="editar-director-nombres" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Apellidos *</label>
                            <input type="text" id="editar-director-apellidos" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Teléfono *</label>
                            <input type="tel" id="editar-director-telefono" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="editar-director-email" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Plantel Asignado *</label>
                            <select id="editar-director-plantel" class="form-control" required>
                                <option value="">Seleccione un plantel</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-editar-director')">Cancelar</button>
                <button class="btn btn-primary" onclick="actualizarDirector()">Actualizar Director</button>
            </div>
        </div>
    </div>

    <!-- Modal para Nuevo Docente -->
    <div id="modal-docente" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nuevo Docente</h3>
                <button class="close-modal" onclick="closeModal('modal-docente')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-docente">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Cédula *</label>
                            <input type="text" id="docente-cedula" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Nombres *</label>
                            <input type="text" id="docente-nombres" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Apellidos *</label>
                            <input type="text" id="docente-apellidos" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Especialidad *</label>
                            <input type="text" id="docente-especialidad" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Teléfono *</label>
                            <input type="tel" id="docente-telefono" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="docente-email" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Plantel *</label>
                            <select id="docente-plantel" class="form-control" required>
                                <option value="">Seleccione un plantel</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-docente')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarDocente()">Guardar Docente</button>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Docente -->
    <div id="modal-editar-docente" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Docente</h3>
                <button class="close-modal" onclick="closeModal('modal-editar-docente')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-editar-docente">
                    <input type="hidden" id="editar-docente-id">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Cédula *</label>
                            <input type="text" id="editar-docente-cedula" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Nombres *</label>
                            <input type="text" id="editar-docente-nombres" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Apellidos *</label>
                            <input type="text" id="editar-docente-apellidos" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Especialidad *</label>
                            <input type="text" id="editar-docente-especialidad" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Teléfono *</label>
                            <input type="tel" id="editar-docente-telefono" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="editar-docente-email" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Plantel *</label>
                            <select id="editar-docente-plantel" class="form-control" required>
                                <option value="">Seleccione un plantel</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-editar-docente')">Cancelar</button>
                <button class="btn btn-primary" onclick="actualizarDocente()">Actualizar Docente</button>
            </div>
        </div>
    </div>

    <!-- Modal para Nuevo Participante -->
    <div id="modal-participante" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nuevo Participante</h3>
                <button class="close-modal" onclick="closeModal('modal-participante')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-participante">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Nombres *</label>
                            <input type="text" id="participante-nombres" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Apellidos *</label>
                            <input type="text" id="participante-apellidos" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Cédula *</label>
                            <input type="text" id="participante-cedula" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Teléfono *</label>
                            <input type="tel" id="participante-telefono" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Correo Electrónico *</label>
                            <input type="email" id="participante-email" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Edad *</label>
                            <input type="number" id="participante-edad" class="form-control" required min="16">
                        </div>
                        <div class="form-group">
                            <label>Sexo *</label>
                            <select id="participante-sexo" class="form-control" required>
                                <option value="">Seleccionar</option>
                                <option value="masculino">Masculino</option>
                                <option value="femenino">Femenino</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Fecha de Nacimiento *</label>
                            <input type="date" id="participante-fecha-nacimiento" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Lugar de Nacimiento *</label>
                            <input type="text" id="participante-lugar-nacimiento" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Parroquia donde vive *</label>
                            <input type="text" id="participante-parroquia" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Dirección de Habitación *</label>
                            <input type="text" id="participante-direccion" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>¿Posée alguna discapacidad? *</label>
                            <select id="participante-discapacidad" class="form-control" required onchange="toggleDiscapacidad()">
                                <option value="">Seleccionar</option>
                                <option value="no">No</option>
                                <option value="si">Sí</option>
                            </select>
                        </div>
                        <div class="form-group" id="discapacidad-detalle" style="display: none;">
                            <label>Indicar Discapacidad</label>
                            <input type="text" id="participante-discapacidad-detalle" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Talla de Camisa</label>
                            <input type="text" id="participante-talla-camisa" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Peso (kg)</label>
                            <input type="number" id="participante-peso" class="form-control" min="0">
                        </div>
                        <div class="form-group">
                            <label>Talla de Pantalón</label>
                            <input type="text" id="participante-talla-pantalon" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Talla de Zapato</label>
                            <input type="number" id="participante-talla-zapato" class="form-control" min="0">
                        </div>
                        <div class="form-group">
                            <label>Ocupación Actual</label>
                            <input type="text" id="participante-ocupacion" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Grado de Instrucción *</label>
                            <select id="participante-grado-instruccion" class="form-control" required>
                                <option value="">Seleccionar</option>
                                <option value="primaria">Primaria</option>
                                <option value="bachiller">Bachiller</option>
                                <option value="tecnico">Técnico</option>
                                <option value="universitario">Universitario</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Plantel *</label>
                            <select id="participante-plantel" class="form-control" required onchange="cargarDocentesYFormaciones()">
                                <option value="">Seleccionar Plantel</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Docente Responsable *</label>
                            <select id="participante-docente" class="form-control" required onchange="cargarFormacionesPorDocente()">
                                <option value="">Seleccionar Docente</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Formación a Inscribir *</label>
                            <select id="participante-formacion" class="form-control" required>
                                <option value="">Seleccionar Formación</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-participante')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarParticipante()">Guardar Participante</button>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Participante -->
    <div id="modal-editar-participante" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Participante</h3>
                <button class="close-modal" onclick="closeModal('modal-editar-participante')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-editar-participante">
                    <input type="hidden" id="editar-participante-id">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Nombres *</label>
                            <input type="text" id="editar-participante-nombres" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Apellidos *</label>
                            <input type="text" id="editar-participante-apellidos" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Cédula *</label>
                            <input type="text" id="editar-participante-cedula" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Teléfono *</label>
                            <input type="tel" id="editar-participante-telefono" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Correo Electrónico *</label>
                            <input type="email" id="editar-participante-email" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Edad *</label>
                            <input type="number" id="editar-participante-edad" class="form-control" required min="16">
                        </div>
                        <div class="form-group">
                            <label>Sexo *</label>
                            <select id="editar-participante-sexo" class="form-control" required>
                                <option value="">Seleccionar</option>
                                <option value="masculino">Masculino</option>
                                <option value="femenino">Femenino</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Fecha de Nacimiento *</label>
                            <input type="date" id="editar-participante-fecha-nacimiento" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Lugar de Nacimiento *</label>
                            <input type="text" id="editar-participante-lugar-nacimiento" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Parroquia donde vive *</label>
                            <input type="text" id="editar-participante-parroquia" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Dirección de Habitación *</label>
                            <input type="text" id="editar-participante-direccion" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>¿Posée alguna discapacidad? *</label>
                            <select id="editar-participante-discapacidad" class="form-control" required onchange="toggleDiscapacidadEditar()">
                                <option value="">Seleccionar</option>
                                <option value="no">No</option>
                                <option value="si">Sí</option>
                            </select>
                        </div>
                        <div class="form-group" id="editar-discapacidad-detalle" style="display: none;">
                            <label>Indicar Discapacidad</label>
                            <input type="text" id="editar-participante-discapacidad-detalle" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Talla de Camisa</label>
                            <input type="text" id="editar-participante-talla-camisa" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Peso (kg)</label>
                            <input type="number" id="editar-participante-peso" class="form-control" min="0">
                        </div>
                        <div class="form-group">
                            <label>Talla de Pantalón</label>
                            <input type="text" id="editar-participante-talla-pantalon" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Talla de Zapato</label>
                            <input type="number" id="editar-participante-talla-zapato" class="form-control" min="0">
                        </div>
                        <div class="form-group">
                            <label>Ocupación Actual</label>
                            <input type="text" id="editar-participante-ocupacion" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Grado de Instrucción *</label>
                            <select id="editar-participante-grado-instruccion" class="form-control" required>
                                <option value="">Seleccionar</option>
                                <option value="primaria">Primaria</option>
                                <option value="bachiller">Bachiller</option>
                                <option value="tecnico">Técnico</option>
                                <option value="universitario">Universitario</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Plantel *</label>
                            <select id="editar-participante-plantel" class="form-control" required onchange="cargarDocentesYFormacionesEditar()">
                                <option value="">Seleccionar Plantel</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Docente Responsable *</label>
                            <select id="editar-participante-docente" class="form-control" required onchange="cargarFormacionesPorDocenteEditar()">
                                <option value="">Seleccionar Docente</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Formación a Inscribir *</label>
                            <select id="editar-participante-formacion" class="form-control" required>
                                <option value="">Seleccionar Formación</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-editar-participante')">Cancelar</button>
                <button class="btn btn-primary" onclick="actualizarParticipante()">Actualizar Participante</button>
            </div>
        </div>
    </div>

    <!-- Modal para Nueva Formación -->
    <div id="modal-formacion" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nueva Formación</h3>
                <button class="close-modal" onclick="closeModal('modal-formacion')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-formacion">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Código *</label>
                            <input type="text" id="formacion-codigo" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Nombre *</label>
                            <input type="text" id="formacion-nombre" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Descripción</label>
                            <textarea id="formacion-descripcion" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Duración (horas) *</label>
                            <input type="number" id="formacion-duracion" class="form-control" required min="1">
                        </div>
                        <div class="form-group">
                            <label>Modalidad *</label>
                            <select id="formacion-modalidad" class="form-control" required>
                                <option value="">Seleccionar</option>
                                <option value="presencial">Presencial</option>
                                <option value="virtual">Virtual</option>
                                <option value="mixta">Mixta</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Plantel *</label>
                            <select id="formacion-plantel" class="form-control" required onchange="cargarDocentesPorPlantelFormacion()">
                                <option value="">Seleccionar Plantel</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Docente *</label>
                            <select id="formacion-docente" class="form-control" required>
                                <option value="">Seleccionar Docente</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Fecha Inicio *</label>
                            <input type="date" id="formacion-fecha-inicio" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Fecha Fin *</label>
                            <input type="date" id="formacion-fecha-fin" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Vacantes *</label>
                            <input type="number" id="formacion-vacantes" class="form-control" required min="1">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-formacion')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarFormacion()">Guardar Formación</button>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Formación -->
    <div id="modal-editar-formacion" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Formación</h3>
                <button class="close-modal" onclick="closeModal('modal-editar-formacion')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-editar-formacion">
                    <input type="hidden" id="editar-formacion-id">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Código *</label>
                            <input type="text" id="editar-formacion-codigo" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Nombre *</label>
                            <input type="text" id="editar-formacion-nombre" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Descripción</label>
                            <textarea id="editar-formacion-descripcion" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Duración (horas) *</label>
                            <input type="number" id="editar-formacion-duracion" class="form-control" required min="1">
                        </div>
                        <div class="form-group">
                            <label>Modalidad *</label>
                            <select id="editar-formacion-modalidad" class="form-control" required>
                                <option value="">Seleccionar</option>
                                <option value="presencial">Presencial</option>
                                <option value="virtual">Virtual</option>
                                <option value="mixta">Mixta</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Plantel *</label>
                            <select id="editar-formacion-plantel" class="form-control" required onchange="cargarDocentesPorPlantelFormacionEditar()">
                                <option value="">Seleccionar Plantel</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Docente *</label>
                            <select id="editar-formacion-docente" class="form-control" required>
                                <option value="">Seleccionar Docente</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Fecha Inicio *</label>
                            <input type="date" id="editar-formacion-fecha-inicio" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Fecha Fin *</label>
                            <input type="date" id="editar-formacion-fecha-fin" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Vacantes *</label>
                            <input type="number" id="editar-formacion-vacantes" class="form-control" required min="1">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-editar-formacion')">Cancelar</button>
                <button class="btn btn-primary" onclick="actualizarFormacion()">Actualizar Formación</button>
            </div>
        </div>
    </div>

    <!-- Modal para Nuevo Usuario -->
    <div id="modal-usuario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nuevo Usuario</h3>
                <button class="close-modal" onclick="closeModal('modal-usuario')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-usuario">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Seleccionar Plantel *</label>
                            <select id="usuario-plantel" class="form-control" required onchange="cambiarTipoUsuario()">
                                <option value="">Seleccionar Plantel</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Seleccionar Rol *</label>
                            <select id="usuario-rol" class="form-control" required onchange="cambiarTipoUsuario()">
                                <option value="">Seleccionar Rol</option>
                                <option value="plantel">Plantel</option>
                                <option value="director">Director</option>
                                <option value="docente">Docente</option>
                                <option value="participante">Participante</option>
                            </select>
                        </div>
                        <div class="form-group" id="usuario-entidad-container" style="display: none;">
                            <label id="usuario-entidad-label">Seleccionar</label>
                            <select id="usuario-entidad" class="form-control">
                                <!-- Se llena dinámicamente según el rol -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Usuario *</label>
                            <input type="text" id="usuario-username" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Contraseña *</label>
                            <input type="password" id="usuario-password" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Confirmar Contraseña *</label>
                            <input type="password" id="usuario-confirm-password" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="usuario-email" class="form-control" required>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-usuario')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarUsuario()">Guardar Usuario</button>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Usuario -->
    <div id="modal-editar-usuario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Usuario</h3>
                <button class="close-modal" onclick="closeModal('modal-editar-usuario')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-editar-usuario">
                    <input type="hidden" id="editar-usuario-id">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Rol *</label>
                            <select id="editar-usuario-rol" class="form-control" required onchange="cambiarTipoUsuarioEditar()">
                                <option value="">Seleccionar Rol</option>
                                <option value="admin">Administrador</option>
                                <option value="plantel">Plantel</option>
                                <option value="director">Director</option>
                                <option value="docente">Docente</option>
                                <option value="participante">Participante</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Usuario *</label>
                            <input type="text" id="editar-usuario-username" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Contraseña (dejar en blanco para no cambiar)</label>
                            <input type="password" id="editar-usuario-password" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Confirmar Contraseña</label>
                            <input type="password" id="editar-usuario-confirm-password" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="editar-usuario-email" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Estado *</label>
                            <select id="editar-usuario-estado" class="form-control" required>
                                <option value="activo">Activo</option>
                                <option value="inactivo">Inactivo</option>
                            </select>
                        </div>
                        <div class="form-group" id="editar-usuario-entidad-container" style="display: none;">
                            <label id="editar-usuario-entidad-label">Entidad</label>
                            <select id="editar-usuario-entidad" class="form-control">
                                <!-- Se llena dinámicamente según el rol -->
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-editar-usuario')">Cancelar</button>
                <button class="btn btn-primary" onclick="actualizarUsuario()">Actualizar Usuario</button>
            </div>
        </div>
    </div>

    <!-- Modal para Carnet -->
    <div id="modal-carnet" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Carnet de Participante</h3>
                <button class="close-modal" onclick="closeModal('modal-carnet')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="carnet-content" class="text-center">
                    <!-- El carnet se genera aquí -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-carnet')">Cerrar</button>
                <button class="btn btn-primary" onclick="descargarCarnet()">
                    <i class="fas fa-download"></i> Descargar Carnet
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== SISTEMA COMPLETO =====
        let datosSistema = {
            planteles: [],
            directores: [],
            docentes: [],
            participantes: [],
            formaciones: [],
            usuarios: [],
            configuracion: {
                intervaloActualizacion: 5,
                frecuenciaBackup: 'daily',
                modoConexion: 'online'
            }
        };

        let currentUser = null;
        let currentRole = null;
        let intervaloActualizacion = null;
        let modoConexion = 'online';
        let editandoId = null;

        // ===== INICIALIZACIÓN =====
        document.addEventListener('DOMContentLoaded', function() {
            cargarDatos();
            inicializarEventos();
            configurarModoConexion();
            iniciarSincronizacionAutomatica();
        });

        function cargarDatos() {
            const datosGuardados = localStorage.getItem('complejoVirtualEPE');
            if (datosGuardados) {
                datosSistema = JSON.parse(datosGuardados);
            } else {
                // Crear usuario administrador inicial
                datosSistema.usuarios = [{
                    id: 1,
                    username: 'admin',
                    password: 'Perp.241',
                    email: 'pabloemiliorico24@gmail.com',
                    nombre: 'Administrador Principal',
                    rol: 'admin',
                    entidadId: null,
                    estado: 'activo',
                    ultimoAcceso: null
                }];
                guardarDatos();
            }
            actualizarEstadisticas();
        }

        function guardarDatos() {
            localStorage.setItem('complejoVirtualEPE', JSON.stringify(datosSistema));
            // Crear backup automático
            crearBackupAutomatico();
        }

        // ===== EVENTOS =====
        function inicializarEventos() {
            // Login
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });

            // Toggle password
            document.getElementById('toggle-password').addEventListener('click', function() {
                const passwordInput = document.getElementById('password');
                const icon = this.querySelector('i');
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.classList.replace('fa-eye', 'fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    icon.classList.replace('fa-eye-slash', 'fa-eye');
                }
            });

            // Modo conexión
            document.querySelectorAll('.connection-mode-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.connection-mode-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    modoConexion = this.dataset.mode;
                    configurarModoConexion();
                });
            });

            // Logout
            document.querySelectorAll('[id^="logout-btn"]').forEach(btn => {
                btn.addEventListener('click', logout);
            });

            // Sincronizar
            document.getElementById('sync-now-btn')?.addEventListener('click', sincronizarDatos);

            // Reparar sistema
            document.getElementById('repair-system-btn')?.addEventListener('click', repararSistema);

            // Navegación
            document.querySelectorAll('.nav-item[data-section]').forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.dataset.section;
                    switchSection(section);
                });
            });
        }

        // ===== LOGIN =====
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;

            if (!username || !password || !role) {
                showAlert('Por favor, complete todos los campos', 'error');
                return;
            }

            // Credenciales del administrador principal
            if (username === 'pabloemiliorico24@gmail.com' && password === 'Perp.241' && role === 'admin') {
                currentUser = {
                    id: 1,
                    username: 'admin',
                    password: 'Perp.241',
                    email: 'pabloemiliorico24@gmail.com',
                    nombre: 'Administrador Principal',
                    rol: 'admin',
                    entidadId: null,
                    estado: 'activo',
                    ultimoAcceso: new Date().toISOString()
                };
                currentRole = 'admin';
                mostrarDashboard('admin', currentUser);
                showAlert(`¡Bienvenido, Administrador Principal!`, 'success');
                return;
            }

            const usuario = datosSistema.usuarios.find(u => 
                u.username === username && 
                u.rol === role && 
                u.estado === 'activo'
            );

            if (!usuario) {
                showAlert('Usuario no encontrado o inactivo', 'error');
                return;
            }

            if (usuario.password !== password) {
                showAlert('Contraseña incorrecta', 'error');
                return;
            }

            // Actualizar último acceso
            usuario.ultimoAcceso = new Date().toISOString();
            guardarDatos();

            // Iniciar sesión
            currentUser = usuario;
            currentRole = role;

            // Mostrar dashboard correspondiente
            mostrarDashboard(role, usuario);

            showAlert(`¡Bienvenido, ${usuario.nombre}!`, 'success');
        }

        function mostrarDashboard(role, usuario) {
            // Ocultar login
            document.getElementById('login-container').classList.add('hidden');
            // Mostrar theme selector
            document.getElementById('theme-selector').classList.remove('hidden');

            // Ocultar todos los dashboards
            document.querySelectorAll('.dashboard-container').forEach(dash => {
                dash.classList.add('hidden');
            });

            // Mostrar dashboard correspondiente
            const dashboardId = `${role}-dashboard`;
            document.getElementById(dashboardId).classList.remove('hidden');

            // Configurar interfaz
            configurarInterfaz(role, usuario);

            // Mostrar botón GitHub solo para admin
            if (role === 'admin') {
                document.getElementById('github-btn-admin').classList.remove('hidden');
            }
        }

        function configurarInterfaz(role, usuario) {
            switch(role) {
                case 'admin':
                    document.getElementById('admin-name').textContent = usuario.nombre;
                    document.getElementById('admin-avatar').textContent = usuario.nombre.charAt(0);
                    cargarSeccionAdmin('dashboard');
                    break;
                case 'plantel':
                    document.getElementById('plantel-name').textContent = usuario.nombre;
                    document.getElementById('plantel-avatar').textContent = usuario.nombre.charAt(0);
                    cargarSeccionPlantel('dashboard-plantel');
                    break;
                case 'director':
                    document.getElementById('director-name').textContent = usuario.nombre;
                    document.getElementById('director-avatar').textContent = usuario.nombre.charAt(0);
                    cargarSeccionDirector('dashboard-director');
                    break;
                case 'docente':
                    document.getElementById('docente-name').textContent = usuario.nombre;
                    document.getElementById('docente-avatar').textContent = usuario.nombre.charAt(0);
                    cargarSeccionDocente('dashboard-docente');
                    break;
                case 'participante':
                    document.getElementById('participante-name').textContent = usuario.nombre;
                    document.getElementById('participante-avatar').textContent = usuario.nombre.charAt(0);
                    cargarSeccionParticipante('dashboard-participante');
                    break;
            }
        }

        // ===== NAVEGACIÓN =====
        function switchSection(sectionId) {
            // Actualizar navegación activa
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            const navItem = document.querySelector(`[data-section="${sectionId}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }

            // Ocultar todas las secciones
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('hidden');
            });

            // Mostrar sección seleccionada
            const seccion = document.getElementById(`section-${sectionId}`);
            if (seccion) {
                seccion.classList.remove('hidden');
            }

            // Cargar datos de la sección
            if (currentRole === 'admin') {
                cargarSeccionAdmin(sectionId);
            } else if (currentRole === 'plantel') {
                cargarSeccionPlantel(sectionId);
            } else if (currentRole === 'director') {
                cargarSeccionDirector(sectionId);
            } else if (currentRole === 'docente') {
                cargarSeccionDocente(sectionId);
            } else if (currentRole === 'participante') {
                cargarSeccionParticipante(sectionId);
            }
        }

        // ===== SECCIONES ADMIN =====
        function cargarSeccionAdmin(sectionId) {
            switch(sectionId) {
                case 'dashboard':
                    actualizarEstadisticas();
                    break;
                case 'planteles':
                    cargarPlanteles();
                    break;
                case 'directores':
                    cargarDirectores();
                    break;
                case 'docentes':
                    cargarDocentes();
                    break;
                case 'participantes':
                    cargarParticipantes();
                    break;
                case 'formaciones':
                    cargarFormaciones();
                    break;
                case 'usuarios':
                    cargarUsuarios();
                    break;
                case 'mi-perfil':
                    cargarPerfilAdmin();
                    break;
                case 'configuracion':
                    cargarConfiguracion();
                    break;
                case 'reportes':
                    break;
            }
        }

        function cargarPlanteles() {
            const tbody = document.querySelector('#tabla-planteles tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            datosSistema.planteles.forEach(plantel => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${plantel.id}</td>
                    <td>${plantel.codigoDependencia}</td>
                    <td>${plantel.codigoPlantel}</td>
                    <td>${plantel.nombre}</td>
                    <td>${plantel.ciudad}</td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="editarPlantel(${plantel.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-success" onclick="accederInterfazDesdeAdmin('plantel', ${plantel.id})">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="eliminarPlantel(${plantel.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function cargarDirectores() {
            const tbody = document.querySelector('#tabla-directores tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            datosSistema.directores.forEach(director => {
                const plantel = datosSistema.planteles.find(p => p.id === director.plantelId);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${director.id}</td>
                    <td>${director.cedula}</td>
                    <td>${director.nombres} ${director.apellidos}</td>
                    <td>${director.email}</td>
                    <td>${plantel ? plantel.nombre : 'No asignado'}</td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="editarDirector(${director.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-success" onclick="accederInterfazDesdeAdmin('director', ${director.id})">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="eliminarDirector(${director.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function cargarDocentes() {
            const tbody = document.querySelector('#tabla-docentes tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            datosSistema.docentes.forEach(docente => {
                const plantel = datosSistema.planteles.find(p => p.id === docente.plantelId);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${docente.id}</td>
                    <td>${docente.cedula}</td>
                    <td>${docente.nombres} ${docente.apellidos}</td>
                    <td>${docente.especialidad}</td>
                    <td>${docente.email}</td>
                    <td>${plantel ? plantel.nombre : 'No asignado'}</td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="editarDocente(${docente.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-success" onclick="accederInterfazDesdeAdmin('docente', ${docente.id})">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="eliminarDocente(${docente.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function cargarParticipantes() {
            const tbody = document.querySelector('#tabla-participantes tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            datosSistema.participantes.forEach(participante => {
                const formacion = datosSistema.formaciones.find(f => f.id === participante.formacionId);
                const plantel = datosSistema.planteles.find(p => p.id === participante.plantelId);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${participante.id}</td>
                    <td>${participante.cedula}</td>
                    <td>${participante.nombres} ${participante.apellidos}</td>
                    <td>${participante.edad}</td>
                    <td>${participante.email}</td>
                    <td>${formacion ? formacion.nombre : 'No asignado'}</td>
                    <td>${plantel ? plantel.nombre : 'No asignado'}</td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="editarParticipante(${participante.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-success" onclick="accederInterfazDesdeAdmin('participante', ${participante.id})">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="eliminarParticipante(${participante.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function cargarFormaciones() {
            const tbody = document.querySelector('#tabla-formaciones tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            datosSistema.formaciones.forEach(formacion => {
                const docente = datosSistema.docentes.find(d => d.id === formacion.docenteId);
                const plantel = datosSistema.planteles.find(p => p.id === formacion.plantelId);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formacion.id}</td>
                    <td>${formacion.codigo}</td>
                    <td>${formacion.nombre}</td>
                    <td>${formacion.duracion} horas</td>
                    <td>${formacion.modalidad}</td>
                    <td>${docente ? `${docente.nombres} ${docente.apellidos}` : 'No asignado'}</td>
                    <td>${plantel ? plantel.nombre : 'No asignado'}</td>
                    <td>${formacion.vacantes}</td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="editarFormacion(${formacion.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="eliminarFormacion(${formacion.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function cargarUsuarios() {
            const tbody = document.querySelector('#tabla-usuarios tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            datosSistema.usuarios.forEach(usuario => {
                let entidadNombre = 'N/A';
                if (usuario.entidadId) {
                    switch(usuario.rol) {
                        case 'plantel':
                            const plantel = datosSistema.planteles.find(p => p.id === usuario.entidadId);
                            entidadNombre = plantel ? plantel.nombre : 'N/A';
                            break;
                        case 'director':
                            const director = datosSistema.directores.find(d => d.id === usuario.entidadId);
                            entidadNombre = director ? `${director.nombres} ${director.apellidos}` : 'N/A';
                            break;
                        case 'docente':
                            const docente = datosSistema.docentes.find(d => d.id === usuario.entidadId);
                            entidadNombre = docente ? `${docente.nombres} ${docente.apellidos}` : 'N/A';
                            break;
                        case 'participante':
                            const participante = datosSistema.participantes.find(p => p.id === usuario.entidadId);
                            entidadNombre = participante ? `${participante.nombres} ${participante.apellidos}` : 'N/A';
                            break;
                    }
                }
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${usuario.id}</td>
                    <td>${usuario.username}</td>
                    <td>${usuario.nombre}</td>
                    <td><span class="badge badge-info">${usuario.rol}</span></td>
                    <td>${usuario.email}</td>
                    <td>${entidadNombre}</td>
                    <td><span class="badge ${usuario.estado === 'activo' ? 'badge-success' : 'badge-danger'}">${usuario.estado}</span></td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="editarUsuario(${usuario.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-success" onclick="accederInterfazDesdeUsuario(${usuario.id})">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                        ${usuario.id !== 1 ? `
                            <button class="btn btn-sm btn-danger" onclick="eliminarUsuario(${usuario.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        ` : ''}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function cargarPerfilAdmin() {
            const usuario = datosSistema.usuarios.find(u => u.id === 1);
            if (usuario) {
                document.getElementById('admin-profile-name').value = usuario.nombre;
                document.getElementById('admin-profile-email').value = usuario.email;
            }
        }

        function cargarConfiguracion() {
            document.getElementById('intervalo-sincronizacion').value = datosSistema.configuracion.intervaloActualizacion;
            document.getElementById('frecuencia-backup').value = datosSistema.configuracion.frecuenciaBackup;
        }

        // ===== SECCIONES PLANTEL =====
        function cargarSeccionPlantel(sectionId) {
            const plantelId = currentUser.entidadId;
            const plantel = datosSistema.planteles.find(p => p.id === plantelId);

            if (!plantel) {
                showAlert('Plantel no encontrado', 'error');
                return;
            }

            switch(sectionId) {
                case 'dashboard-plantel':
                    cargarEstadisticasPlantel(plantelId);
                    cargarInfoPlantel(plantel);
                    break;
                case 'mi-perfil-plantel':
                    cargarPerfilPlantel(plantel);
                    break;
                case 'docentes-plantel':
                    cargarDocentesPlantel(plantelId);
                    break;
                case 'participantes-plantel':
                    cargarParticipantesPlantel(plantelId);
                    break;
                case 'formaciones-plantel':
                    cargarFormacionesPlantel(plantelId);
                    break;
            }
        }

        function cargarEstadisticasPlantel(plantelId) {
            const directores = datosSistema.directores.filter(d => d.plantelId === plantelId).length;
            const docentes = datosSistema.docentes.filter(d => d.plantelId === plantelId).length;
            const participantes = datosSistema.participantes.filter(p => p.plantelId === plantelId).length;
            const formaciones = datosSistema.formaciones.filter(f => f.plantelId === plantelId).length;

            document.getElementById('stat-directores-plantel').textContent = directores;
            document.getElementById('stat-docentes-plantel').textContent = docentes;
            document.getElementById('stat-participantes-plantel').textContent = participantes;
            document.getElementById('stat-formaciones-plantel').textContent = formaciones;
        }

        function cargarInfoPlantel(plantel) {
            const director = datosSistema.directores.find(d => d.plantelId === plantel.id);
            const infoDiv = document.getElementById('info-plantel-detalle');
            infoDiv.innerHTML = `
                <p><strong>Código Dependencia:</strong> ${plantel.codigoDependencia}</p>
                <p><strong>Código Plantel:</strong> ${plantel.codigoPlantel}</p>
                <p><strong>Nombre:</strong> ${plantel.nombre}</p>
                <p><strong>Dirección:</strong> ${plantel.direccion}, ${plantel.ciudad}</p>
                <p><strong>Teléfono:</strong> ${plantel.telefono || 'No registrado'}</p>
                <p><strong>Email:</strong> ${plantel.email || 'No registrado'}</p>
                <p><strong>Director:</strong> ${director ? `${director.nombres} ${director.apellidos}` : 'No asignado'}</p>
            `;
        }

        function cargarPerfilPlantel(plantel) {
            const div = document.getElementById('perfil-plantel-detalle');
            div.innerHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <label>Código Dependencia</label>
                        <input type="text" class="form-control" value="${plantel.codigoDependencia}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Código Plantel</label>
                        <input type="text" class="form-control" value="${plantel.codigoPlantel}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Nombre</label>
                        <input type="text" class="form-control" value="${plantel.nombre}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Dirección</label>
                        <input type="text" class="form-control" value="${plantel.direccion}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Ciudad</label>
                        <input type="text" class="form-control" value="${plantel.ciudad}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Teléfono</label>
                        <input type="text" class="form-control" value="${plantel.telefono || ''}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" value="${plantel.email || ''}" readonly>
                    </div>
                </div>
            `;
        }

        function cargarDocentesPlantel(plantelId) {
            const tbody = document.querySelector('#tabla-docentes-plantel tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const docentes = datosSistema.docentes.filter(d => d.plantelId === plantelId);
            docentes.forEach(docente => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${docente.id}</td>
                    <td>${docente.cedula}</td>
                    <td>${docente.nombres} ${docente.apellidos}</td>
                    <td>${docente.especialidad}</td>
                    <td>${docente.email}</td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="editarDocente(${docente.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function cargarParticipantesPlantel(plantelId) {
            const tbody = document.querySelector('#tabla-participantes-plantel tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const participantes = datosSistema.participantes.filter(p => p.plantelId === plantelId);
            participantes.forEach(participante => {
                const formacion = datosSistema.formaciones.find(f => f.id === participante.formacionId);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${participante.id}</td>
                    <td>${participante.cedula}</td>
                    <td>${participante.nombres} ${participante.apellidos}</td>
                    <td>${participante.edad}</td>
                    <td>${participante.email}</td>
                    <td>${formacion ? formacion.nombre : 'No asignado'}</td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="editarParticipante(${participante.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-success" onclick="generarCarnet(${participante.id})">
                            <i class="fas fa-id-card"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function cargarFormacionesPlantel(plantelId) {
            const tbody = document.querySelector('#tabla-formaciones-plantel tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const formaciones = datosSistema.formaciones.filter(f => f.plantelId === plantelId);
            formaciones.forEach(formacion => {
                const docente = datosSistema.docentes.find(d => d.id === formacion.docenteId);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formacion.id}</td>
                    <td>${formacion.codigo}</td>
                    <td>${formacion.nombre}</td>
                    <td>${formacion.duracion} horas</td>
                    <td>${formacion.modalidad}</td>
                    <td>${docente ? `${docente.nombres} ${docente.apellidos}` : 'No asignado'}</td>
                    <td>${formacion.vacantes}</td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="editarFormacion(${formacion.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ===== SECCIONES DIRECTOR =====
        function cargarSeccionDirector(sectionId) {
            const directorId = currentUser.entidadId;
            const director = datosSistema.directores.find(d => d.id === directorId);

            if (!director) {
                showAlert('Director no encontrado', 'error');
                return;
            }

            const plantelId = director.plantelId;

            switch(sectionId) {
                case 'dashboard-director':
                    cargarEstadisticasDirector(plantelId);
                    cargarInfoDirector(director);
                    break;
                case 'mi-perfil-director':
                    cargarPerfilDirector(director);
                    break;
                case 'docentes-director':
                    cargarDocentesDirector(plantelId);
                    break;
                case 'participantes-director':
                    cargarParticipantesDirector(plantelId);
                    break;
                case 'formaciones-director':
                    cargarFormacionesDirector(plantelId);
                    break;
            }
        }

        function cargarEstadisticasDirector(plantelId) {
            const docentes = datosSistema.docentes.filter(d => d.plantelId === plantelId).length;
            const participantes = datosSistema.participantes.filter(p => p.plantelId === plantelId).length;
            const formaciones = datosSistema.formaciones.filter(f => f.plantelId === plantelId).length;

            document.getElementById('stat-docentes-director').textContent = docentes;
            document.getElementById('stat-participantes-director').textContent = participantes;
            document.getElementById('stat-formaciones-director').textContent = formaciones;
        }

        function cargarInfoDirector(director) {
            const plantel = datosSistema.planteles.find(p => p.id === director.plantelId);
            const infoDiv = document.getElementById('info-director-detalle');
            infoDiv.innerHTML = `
                <p><strong>Cédula:</strong> ${director.cedula}</p>
                <p><strong>Nombre:</strong> ${director.nombres} ${director.apellidos}</p>
                <p><strong>Teléfono:</strong> ${director.telefono}</p>
                <p><strong>Email:</strong> ${director.email}</p>
                <p><strong>Plantel:</strong> ${plantel ? plantel.nombre : 'No asignado'}</p>
            `;
        }

        function cargarPerfilDirector(director) {
            const plantel = datosSistema.planteles.find(p => p.id === director.plantelId);
            const div = document.getElementById('perfil-director-detalle');
            div.innerHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <label>Cédula</label>
                        <input type="text" class="form-control" value="${director.cedula}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Nombres</label>
                        <input type="text" class="form-control" value="${director.nombres}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Apellidos</label>
                        <input type="text" class="form-control" value="${director.apellidos}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Teléfono</label>
                        <input type="text" class="form-control" value="${director.telefono}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" value="${director.email}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Plantel</label>
                        <input type="text" class="form-control" value="${plantel ? plantel.nombre : 'No asignado'}" readonly>
                    </div>
                </div>
            `;
        }

        function cargarDocentesDirector(plantelId) {
            const tbody = document.querySelector('#tabla-docentes-director tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const docentes = datosSistema.docentes.filter(d => d.plantelId === plantelId);
            docentes.forEach(docente => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${docente.id}</td>
                    <td>${docente.cedula}</td>
                    <td>${docente.nombres} ${docente.apellidos}</td>
                    <td>${docente.especialidad}</td>
                    <td>${docente.email}</td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="editarDocente(${docente.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function cargarParticipantesDirector(plantelId) {
            const tbody = document.querySelector('#tabla-participantes-director tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const participantes = datosSistema.participantes.filter(p => p.plantelId === plantelId);
            participantes.forEach(participante => {
                const formacion = datosSistema.formaciones.find(f => f.id === participante.formacionId);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${participante.id}</td>
                    <td>${participante.cedula}</td>
                    <td>${participante.nombres} ${participante.apellidos}</td>
                    <td>${participante.edad}</td>
                    <td>${participante.email}</td>
                    <td>${formacion ? formacion.nombre : 'No asignado'}</td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="editarParticipante(${participante.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-success" onclick="generarCarnet(${participante.id})">
                            <i class="fas fa-id-card"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function cargarFormacionesDirector(plantelId) {
            const tbody = document.querySelector('#tabla-formaciones-director tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const formaciones = datosSistema.formaciones.filter(f => f.plantelId === plantelId);
            formaciones.forEach(formacion => {
                const docente = datosSistema.docentes.find(d => d.id === formacion.docenteId);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formacion.id}</td>
                    <td>${formacion.codigo}</td>
                    <td>${formacion.nombre}</td>
                    <td>${formacion.duracion} horas</td>
                    <td>${formacion.modalidad}</td>
                    <td>${docente ? `${docente.nombres} ${docente.apellidos}` : 'No asignado'}</td>
                    <td>${formacion.vacantes}</td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="editarFormacion(${formacion.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ===== SECCIONES DOCENTE =====
        function cargarSeccionDocente(sectionId) {
            const docenteId = currentUser.entidadId;
            const docente = datosSistema.docentes.find(d => d.id === docenteId);

            if (!docente) {
                showAlert('Docente no encontrado', 'error');
                return;
            }

            switch(sectionId) {
                case 'dashboard-docente':
                    cargarEstadisticasDocente(docenteId);
                    cargarInfoDocente(docente);
                    break;
                case 'mi-perfil-docente':
                    cargarPerfilDocente(docente);
                    break;
                case 'formaciones-docente':
                    cargarFormacionesDocente(docenteId);
                    break;
                case 'participantes-docente':
                    cargarParticipantesDocente(docenteId);
                    break;
            }
        }

        function cargarEstadisticasDocente(docenteId) {
            const formaciones = datosSistema.formaciones.filter(f => f.docenteId === docenteId).length;
            const participantes = datosSistema.participantes.filter(p => p.docenteId === docenteId).length;

            document.getElementById('stat-formaciones-docente').textContent = formaciones;
            document.getElementById('stat-participantes-docente').textContent = participantes;
        }

        function cargarInfoDocente(docente) {
            const plantel = datosSistema.planteles.find(p => p.id === docente.plantelId);
            const infoDiv = document.getElementById('info-docente-detalle');
            infoDiv.innerHTML = `
                <p><strong>Cédula:</strong> ${docente.cedula}</p>
                <p><strong>Nombre:</strong> ${docente.nombres} ${docente.apellidos}</p>
                <p><strong>Especialidad:</strong> ${docente.especialidad}</p>
                <p><strong>Teléfono:</strong> ${docente.telefono}</p>
                <p><strong>Email:</strong> ${docente.email}</p>
                <p><strong>Plantel:</strong> ${plantel ? plantel.nombre : 'No asignado'}</p>
            `;
        }

        function cargarPerfilDocente(docente) {
            const plantel = datosSistema.planteles.find(p => p.id === docente.plantelId);
            const div = document.getElementById('perfil-docente-detalle');
            div.innerHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <label>Cédula</label>
                        <input type="text" class="form-control" value="${docente.cedula}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Nombres</label>
                        <input type="text" class="form-control" value="${docente.nombres}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Apellidos</label>
                        <input type="text" class="form-control" value="${docente.apellidos}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Especialidad</label>
                        <input type="text" class="form-control" value="${docente.especialidad}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Teléfono</label>
                        <input type="text" class="form-control" value="${docente.telefono}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" value="${docente.email}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Plantel</label>
                        <input type="text" class="form-control" value="${plantel ? plantel.nombre : 'No asignado'}" readonly>
                    </div>
                </div>
            `;
        }

        function cargarFormacionesDocente(docenteId) {
            const tbody = document.querySelector('#tabla-formaciones-docente tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const formaciones = datosSistema.formaciones.filter(f => f.docenteId === docenteId);
            formaciones.forEach(formacion => {
                const participantes = datosSistema.participantes.filter(p => p.formacionId === formacion.id).length;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formacion.id}</td>
                    <td>${formacion.codigo}</td>
                    <td>${formacion.nombre}</td>
                    <td>${formacion.duracion} horas</td>
                    <td>${formacion.modalidad}</td>
                    <td>${formacion.vacantes}</td>
                    <td>${participantes}</td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="editarFormacion(${formacion.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function cargarParticipantesDocente(docenteId) {
            const tbody = document.querySelector('#tabla-participantes-docente tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const participantes = datosSistema.participantes.filter(p => p.docenteId === docenteId);
            participantes.forEach(participante => {
                const formacion = datosSistema.formaciones.find(f => f.id === participante.formacionId);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${participante.id}</td>
                    <td>${participante.cedula}</td>
                    <td>${participante.nombres} ${participante.apellidos}</td>
                    <td>${participante.edad}</td>
                    <td>${participante.email}</td>
                    <td>${formacion ? formacion.nombre : 'No asignado'}</td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="editarParticipante(${participante.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-success" onclick="generarCarnet(${participante.id})">
                            <i class="fas fa-id-card"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ===== SECCIONES PARTICIPANTE =====
        function cargarSeccionParticipante(sectionId) {
            const participanteId = currentUser.entidadId;
            const participante = datosSistema.participantes.find(p => p.id === participanteId);

            if (!participante) {
                showAlert('Participante no encontrado', 'error');
                return;
            }

            switch(sectionId) {
                case 'dashboard-participante':
                    cargarEstadisticasParticipante(participanteId);
                    cargarInfoParticipante(participante);
                    break;
                case 'mi-perfil-participante':
                    cargarPerfilParticipante(participante);
                    break;
                case 'mis-formaciones':
                    cargarMisFormaciones(participanteId);
                    break;
                case 'inscribirse-formacion':
                    cargarFormacionesDisponibles(participante);
                    break;
            }
        }

        function cargarEstadisticasParticipante(participanteId) {
            const misFormaciones = datosSistema.formaciones.filter(f => 
                datosSistema.participantes.some(p => p.id === participanteId && p.formacionId === f.id)
            ).length;
            const formacionesDisponibles = datosSistema.formaciones.filter(f => f.vacantes > 0).length;

            document.getElementById('stat-mis-formaciones').textContent = misFormaciones;
            document.getElementById('stat-formaciones-disponibles').textContent = formacionesDisponibles;
        }

        function cargarInfoParticipante(participante) {
            const formacion = datosSistema.formaciones.find(f => f.id === participante.formacionId);
            const plantel = datosSistema.planteles.find(p => p.id === participante.plantelId);
            const docente = datosSistema.docentes.find(d => d.id === participante.docenteId);
            const infoDiv = document.getElementById('info-participante-detalle');
            infoDiv.innerHTML = `
                <p><strong>Cédula:</strong> ${participante.cedula}</p>
                <p><strong>Nombre:</strong> ${participante.nombres} ${participante.apellidos}</p>
                <p><strong>Edad:</strong> ${participante.edad}</p>
                <p><strong>Teléfono:</strong> ${participante.telefono}</p>
                <p><strong>Email:</strong> ${participante.email}</p>
                <p><strong>Formación:</strong> ${formacion ? formacion.nombre : 'No asignado'}</p>
                <p><strong>Plantel:</strong> ${plantel ? plantel.nombre : 'No asignado'}</p>
                <p><strong>Docente:</strong> ${docente ? `${docente.nombres} ${docente.apellidos}` : 'No asignado'}</p>
            `;
        }

        function cargarPerfilParticipante(participante) {
            const formacion = datosSistema.formaciones.find(f => f.id === participante.formacionId);
            const plantel = datosSistema.planteles.find(p => p.id === participante.plantelId);
            const docente = datosSistema.docentes.find(d => d.id === participante.docenteId);
            const div = document.getElementById('perfil-participante-detalle');
            div.innerHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <label>Cédula</label>
                        <input type="text" class="form-control" value="${participante.cedula}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Nombres</label>
                        <input type="text" class="form-control" value="${participante.nombres}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Apellidos</label>
                        <input type="text" class="form-control" value="${participante.apellidos}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Edad</label>
                        <input type="number" class="form-control" value="${participante.edad}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Teléfono</label>
                        <input type="text" class="form-control" value="${participante.telefono}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" value="${participante.email}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Formación</label>
                        <input type="text" class="form-control" value="${formacion ? formacion.nombre : 'No asignado'}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Plantel</label>
                        <input type="text" class="form-control" value="${plantel ? plantel.nombre : 'No asignado'}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Docente</label>
                        <input type="text" class="form-control" value="${docente ? `${docente.nombres} ${docente.apellidos}` : 'No asignado'}" readonly>
                    </div>
                </div>
            `;
        }

        function cargarMisFormaciones(participanteId) {
            const tbody = document.querySelector('#tabla-mis-formaciones tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const participante = datosSistema.participantes.find(p => p.id === participanteId);
            if (!participante) return;
            
            const formacionesParticipante = datosSistema.formaciones.filter(f => f.id === participante.formacionId);
            
            formacionesParticipante.forEach(formacion => {
                const docente = datosSistema.docentes.find(d => d.id === formacion.docenteId);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formacion.id}</td>
                    <td>${formacion.codigo}</td>
                    <td>${formacion.nombre}</td>
                    <td>${formacion.duracion} horas</td>
                    <td>${formacion.modalidad}</td>
                    <td>${docente ? `${docente.nombres} ${docente.apellidos}` : 'No asignado'}</td>
                    <td><span class="badge badge-success">Inscrito</span></td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="darseDeBaja(${participanteId}, ${formacion.id})">
                            <i class="fas fa-sign-out-alt"></i> Darse de baja
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function cargarFormacionesDisponibles(participante) {
            const selectPlantel = document.getElementById('select-plantel-inscripcion');
            const tbody = document.querySelector('#tabla-formaciones-disponibles tbody');
            
            if (!tbody) return;
            
            // Cargar planteles en el select
            selectPlantel.innerHTML = '<option value="">Seleccionar Plantel</option>';
            datosSistema.planteles.forEach(plantel => {
                const option = document.createElement('option');
                option.value = plantel.id;
                option.textContent = plantel.nombre;
                selectPlantel.appendChild(option);
            });
            
            tbody.innerHTML = '';
            
            const formaciones = datosSistema.formaciones.filter(f => f.vacantes > 0);
            formaciones.forEach(formacion => {
                const docente = datosSistema.docentes.find(d => d.id === formacion.docenteId);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formacion.id}</td>
                    <td>${formacion.codigo}</td>
                    <td>${formacion.nombre}</td>
                    <td>${formacion.duracion} horas</td>
                    <td>${formacion.modalidad}</td>
                    <td>${docente ? `${docente.nombres} ${docente.apellidos}` : 'No asignado'}</td>
                    <td>${formacion.vacantes}</td>
                    <td>
                        <button class="btn btn-sm btn-success" onclick="inscribirseEnFormacion(${formacion.id})">
                            <i class="fas fa-pen-alt"></i> Inscribirse
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function cargarFormacionesPorPlantel() {
            const plantelId = document.getElementById('select-plantel-inscripcion').value;
            const tbody = document.querySelector('#tabla-formaciones-disponibles tbody');
            
            if (!tbody || !plantelId) return;
            
            tbody.innerHTML = '';
            
            const formaciones = datosSistema.formaciones.filter(f => f.plantelId == plantelId && f.vacantes > 0);
            formaciones.forEach(formacion => {
                const docente = datosSistema.docentes.find(d => d.id === formacion.docenteId);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formacion.id}</td>
                    <td>${formacion.codigo}</td>
                    <td>${formacion.nombre}</td>
                    <td>${formacion.duracion} horas</td>
                    <td>${formacion.modalidad}</td>
                    <td>${docente ? `${docente.nombres} ${docente.apellidos}` : 'No asignado'}</td>
                    <td>${formacion.vacantes}</td>
                    <td>
                        <button class="btn btn-sm btn-success" onclick="inscribirseEnFormacion(${formacion.id})">
                            <i class="fas fa-pen-alt"></i> Inscribirse
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ===== CRUD COMPLETO =====
        
        // PLANTELES
        function guardarPlantel() {
            const plantel = {
                id: generarId(datosSistema.planteles),
                codigoDependencia: document.getElementById('plantel-codigo-dependencia').value,
                codigoPlantel: document.getElementById('plantel-codigo-plantel').value,
                nombre: document.getElementById('plantel-nombre').value,
                direccion: document.getElementById('plantel-direccion').value,
                ciudad: document.getElementById('plantel-ciudad').value,
                telefono: document.getElementById('plantel-telefono').value || '',
                email: document.getElementById('plantel-email').value || '',
                estado: 'activo'
            };

            datosSistema.planteles.push(plantel);
            guardarDatos();
            closeModal('modal-plantel');
            cargarPlanteles();
            actualizarEstadisticas();
            showAlert('Plantel guardado exitosamente', 'success');
        }

        function editarPlantel(id) {
            const plantel = datosSistema.planteles.find(p => p.id === id);
            if (!plantel) return;

            editandoId = id;
            document.getElementById('editar-plantel-id').value = plantel.id;
            document.getElementById('editar-plantel-codigo-dependencia').value = plantel.codigoDependencia;
            document.getElementById('editar-plantel-codigo-plantel').value = plantel.codigoPlantel;
            document.getElementById('editar-plantel-nombre').value = plantel.nombre;
            document.getElementById('editar-plantel-direccion').value = plantel.direccion;
            document.getElementById('editar-plantel-ciudad').value = plantel.ciudad;
            document.getElementById('editar-plantel-telefono').value = plantel.telefono || '';
            document.getElementById('editar-plantel-email').value = plantel.email || '';

            openModal('modal-editar-plantel');
        }

        function actualizarPlantel() {
            const id = editandoId;
            const index = datosSistema.planteles.findIndex(p => p.id === id);
            if (index === -1) return;

            datosSistema.planteles[index] = {
                ...datosSistema.planteles[index],
                codigoDependencia: document.getElementById('editar-plantel-codigo-dependencia').value,
                codigoPlantel: document.getElementById('editar-plantel-codigo-plantel').value,
                nombre: document.getElementById('editar-plantel-nombre').value,
                direccion: document.getElementById('editar-plantel-direccion').value,
                ciudad: document.getElementById('editar-plantel-ciudad').value,
                telefono: document.getElementById('editar-plantel-telefono').value,
                email: document.getElementById('editar-plantel-email').value
            };

            guardarDatos();
            closeModal('modal-editar-plantel');
            cargarPlanteles();
            showAlert('Plantel actualizado exitosamente', 'success');
        }

        function eliminarPlantel(id) {
            if (!confirm('¿Está seguro de eliminar este plantel?')) return;
            
            // Verificar si hay directores, docentes, participantes o formaciones asociados
            const tieneDirectores = datosSistema.directores.some(d => d.plantelId === id);
            const tieneDocentes = datosSistema.docentes.some(d => d.plantelId === id);
            const tieneParticipantes = datosSistema.participantes.some(p => p.plantelId === id);
            const tieneFormaciones = datosSistema.formaciones.some(f => f.plantelId === id);
            
            if (tieneDirectores || tieneDocentes || tieneParticipantes || tieneFormaciones) {
                showAlert('No se puede eliminar el plantel porque tiene registros asociados', 'error');
                return;
            }
            
            datosSistema.planteles = datosSistema.planteles.filter(p => p.id !== id);
            guardarDatos();
            cargarPlanteles();
            actualizarEstadisticas();
            showAlert('Plantel eliminado exitosamente', 'success');
        }

        // DIRECTORES
        function guardarDirector() {
            // Cargar planteles en el select
            const selectPlantel = document.getElementById('director-plantel');
            selectPlantel.innerHTML = '<option value="">Seleccione un plantel</option>';
            datosSistema.planteles.forEach(plantel => {
                const option = document.createElement('option');
                option.value = plantel.id;
                option.textContent = plantel.nombre;
                selectPlantel.appendChild(option);
            });

            const director = {
                id: generarId(datosSistema.directores),
                cedula: document.getElementById('director-cedula').value,
                nombres: document.getElementById('director-nombres').value,
                apellidos: document.getElementById('director-apellidos').value,
                telefono: document.getElementById('director-telefono').value,
                email: document.getElementById('director-email').value,
                plantelId: parseInt(document.getElementById('director-plantel').value),
                estado: 'activo'
            };

            datosSistema.directores.push(director);
            guardarDatos();
            closeModal('modal-director');
            cargarDirectores();
            actualizarEstadisticas();
            showAlert('Director guardado exitosamente', 'success');
        }

        function editarDirector(id) {
            const director = datosSistema.directores.find(d => d.id === id);
            if (!director) return;

            editandoId = id;
            document.getElementById('editar-director-id').value = director.id;
            document.getElementById('editar-director-cedula').value = director.cedula;
            document.getElementById('editar-director-nombres').value = director.nombres;
            document.getElementById('editar-director-apellidos').value = director.apellidos;
            document.getElementById('editar-director-telefono').value = director.telefono;
            document.getElementById('editar-director-email').value = director.email;

            // Llenar select de planteles
            const select = document.getElementById('editar-director-plantel');
            select.innerHTML = '<option value="">Seleccione un plantel</option>';
            datosSistema.planteles.forEach(plantel => {
                const option = document.createElement('option');
                option.value = plantel.id;
                option.textContent = plantel.nombre;
                if (plantel.id === director.plantelId) {
                    option.selected = true;
                }
                select.appendChild(option);
            });

            openModal('modal-editar-director');
        }

        function actualizarDirector() {
            const id = editandoId;
            const index = datosSistema.directores.findIndex(d => d.id === id);
            if (index === -1) return;

            datosSistema.directores[index] = {
                ...datosSistema.directores[index],
                cedula: document.getElementById('editar-director-cedula').value,
                nombres: document.getElementById('editar-director-nombres').value,
                apellidos: document.getElementById('editar-director-apellidos').value,
                telefono: document.getElementById('editar-director-telefono').value,
                email: document.getElementById('editar-director-email').value,
                plantelId: parseInt(document.getElementById('editar-director-plantel').value)
            };

            guardarDatos();
            closeModal('modal-editar-director');
            cargarDirectores();
            showAlert('Director actualizado exitosamente', 'success');
        }

        function eliminarDirector(id) {
            if (!confirm('¿Está seguro de eliminar este director?')) return;
            
            datosSistema.directores = datosSistema.directores.filter(d => d.id !== id);
            guardarDatos();
            cargarDirectores();
            actualizarEstadisticas();
            showAlert('Director eliminado exitosamente', 'success');
        }

        // DOCENTES
        function guardarDocente() {
            // Cargar planteles en el select
            const selectPlantel = document.getElementById('docente-plantel');
            selectPlantel.innerHTML = '<option value="">Seleccione un plantel</option>';
            datosSistema.planteles.forEach(plantel => {
                const option = document.createElement('option');
                option.value = plantel.id;
                option.textContent = plantel.nombre;
                selectPlantel.appendChild(option);
            });

            const docente = {
                id: generarId(datosSistema.docentes),
                cedula: document.getElementById('docente-cedula').value,
                nombres: document.getElementById('docente-nombres').value,
                apellidos: document.getElementById('docente-apellidos').value,
                especialidad: document.getElementById('docente-especialidad').value,
                telefono: document.getElementById('docente-telefono').value,
                email: document.getElementById('docente-email').value,
                plantelId: parseInt(document.getElementById('docente-plantel').value),
                estado: 'activo'
            };

            datosSistema.docentes.push(docente);
            guardarDatos();
            closeModal('modal-docente');
            cargarDocentes();
            actualizarEstadisticas();
            showAlert('Docente guardado exitosamente', 'success');
        }

        function editarDocente(id) {
            const docente = datosSistema.docentes.find(d => d.id === id);
            if (!docente) return;

            editandoId = id;
            document.getElementById('editar-docente-id').value = docente.id;
            document.getElementById('editar-docente-cedula').value = docente.cedula;
            document.getElementById('editar-docente-nombres').value = docente.nombres;
            document.getElementById('editar-docente-apellidos').value = docente.apellidos;
            document.getElementById('editar-docente-especialidad').value = docente.especialidad;
            document.getElementById('editar-docente-telefono').value = docente.telefono;
            document.getElementById('editar-docente-email').value = docente.email;

            // Llenar select de planteles
            const select = document.getElementById('editar-docente-plantel');
            select.innerHTML = '<option value="">Seleccione un plantel</option>';
            datosSistema.planteles.forEach(plantel => {
                const option = document.createElement('option');
                option.value = plantel.id;
                option.textContent = plantel.nombre;
                if (plantel.id === docente.plantelId) {
                    option.selected = true;
                }
                select.appendChild(option);
            });

            openModal('modal-editar-docente');
        }

        function actualizarDocente() {
            const id = editandoId;
            const index = datosSistema.docentes.findIndex(d => d.id === id);
            if (index === -1) return;

            datosSistema.docentes[index] = {
                ...datosSistema.docentes[index],
                cedula: document.getElementById('editar-docente-cedula').value,
                nombres: document.getElementById('editar-docente-nombres').value,
                apellidos: document.getElementById('editar-docente-apellidos').value,
                especialidad: document.getElementById('editar-docente-especialidad').value,
                telefono: document.getElementById('editar-docente-telefono').value,
                email: document.getElementById('editar-docente-email').value,
                plantelId: parseInt(document.getElementById('editar-docente-plantel').value)
            };

            guardarDatos();
            closeModal('modal-editar-docente');
            cargarDocentes();
            showAlert('Docente actualizado exitosamente', 'success');
        }

        function eliminarDocente(id) {
            if (!confirm('¿Está seguro de eliminar este docente?')) return;
            
            // Verificar si hay formaciones asociadas
            const tieneFormaciones = datosSistema.formaciones.some(f => f.docenteId === id);
            if (tieneFormaciones) {
                showAlert('No se puede eliminar el docente porque tiene formaciones asociadas', 'error');
                return;
            }
            
            datosSistema.docentes = datosSistema.docentes.filter(d => d.id !== id);
            guardarDatos();
            cargarDocentes();
            actualizarEstadisticas();
            showAlert('Docente eliminado exitosamente', 'success');
        }

        // PARTICIPANTES
        function toggleDiscapacidad() {
            const discapacidad = document.getElementById('participante-discapacidad').value;
            const detalleDiv = document.getElementById('discapacidad-detalle');
            detalleDiv.style.display = discapacidad === 'si' ? 'block' : 'none';
        }

        function toggleDiscapacidadEditar() {
            const discapacidad = document.getElementById('editar-participante-discapacidad').value;
            const detalleDiv = document.getElementById('editar-discapacidad-detalle');
            detalleDiv.style.display = discapacidad === 'si' ? 'block' : 'none';
        }

        function cargarDocentesYFormaciones() {
            const plantelId = document.getElementById('participante-plantel').value;
            const selectDocente = document.getElementById('participante-docente');
            const selectFormacion = document.getElementById('participante-formacion');
            
            if (!plantelId) {
                selectDocente.innerHTML = '<option value="">Seleccionar Docente</option>';
                selectFormacion.innerHTML = '<option value="">Seleccionar Formación</option>';
                return;
            }

            // Cargar docentes del plantel
            selectDocente.innerHTML = '<option value="">Seleccionar Docente</option>';
            const docentesPlantel = datosSistema.docentes.filter(d => d.plantelId == plantelId);
            docentesPlantel.forEach(docente => {
                const option = document.createElement('option');
                option.value = docente.id;
                option.textContent = `${docente.nombres} ${docente.apellidos}`;
                selectDocente.appendChild(option);
            });

            // Limpiar formaciones
            selectFormacion.innerHTML = '<option value="">Seleccionar Formación</option>';
        }

        function cargarFormacionesPorDocente() {
            const docenteId = document.getElementById('participante-docente').value;
            const selectFormacion = document.getElementById('participante-formacion');
            
            if (!docenteId) {
                selectFormacion.innerHTML = '<option value="">Seleccionar Formación</option>';
                return;
            }

            // Cargar formaciones del docente
            selectFormacion.innerHTML = '<option value="">Seleccionar Formación</option>';
            const formacionesDocente = datosSistema.formaciones.filter(f => f.docenteId == docenteId && f.vacantes > 0);
            formacionesDocente.forEach(formacion => {
                const option = document.createElement('option');
                option.value = formacion.id;
                option.textContent = formacion.nombre;
                selectFormacion.appendChild(option);
            });
        }

        function cargarDocentesYFormacionesEditar() {
            const plantelId = document.getElementById('editar-participante-plantel').value;
            const selectDocente = document.getElementById('editar-participante-docente');
            const selectFormacion = document.getElementById('editar-participante-formacion');
            
            if (!plantelId) {
                selectDocente.innerHTML = '<option value="">Seleccionar Docente</option>';
                selectFormacion.innerHTML = '<option value="">Seleccionar Formación</option>';
                return;
            }

            // Cargar docentes del plantel
            selectDocente.innerHTML = '<option value="">Seleccionar Docente</option>';
            const docentesPlantel = datosSistema.docentes.filter(d => d.plantelId == plantelId);
            docentesPlantel.forEach(docente => {
                const option = document.createElement('option');
                option.value = docente.id;
                option.textContent = `${docente.nombres} ${docente.apellidos}`;
                selectDocente.appendChild(option);
            });

            // Limpiar formaciones
            selectFormacion.innerHTML = '<option value="">Seleccionar Formación</option>';
        }

        function cargarFormacionesPorDocenteEditar() {
            const docenteId = document.getElementById('editar-participante-docente').value;
            const selectFormacion = document.getElementById('editar-participante-formacion');
            
            if (!docenteId) {
                selectFormacion.innerHTML = '<option value="">Seleccionar Formación</option>';
                return;
            }

            // Cargar formaciones del docente
            selectFormacion.innerHTML = '<option value="">Seleccionar Formación</option>';
            const formacionesDocente = datosSistema.formaciones.filter(f => f.docenteId == docenteId && f.vacantes > 0);
            formacionesDocente.forEach(formacion => {
                const option = document.createElement('option');
                option.value = formacion.id;
                option.textContent = formacion.nombre;
                selectFormacion.appendChild(option);
            });
        }

        function guardarParticipante() {
            // Cargar planteles en el select
            const selectPlantel = document.getElementById('participante-plantel');
            selectPlantel.innerHTML = '<option value="">Seleccionar Plantel</option>';
            datosSistema.planteles.forEach(plantel => {
                const option = document.createElement('option');
                option.value = plantel.id;
                option.textContent = plantel.nombre;
                selectPlantel.appendChild(option);
            });

            const participante = {
                id: generarId(datosSistema.participantes),
                cedula: document.getElementById('participante-cedula').value,
                nombres: document.getElementById('participante-nombres').value,
                apellidos: document.getElementById('participante-apellidos').value,
                telefono: document.getElementById('participante-telefono').value,
                email: document.getElementById('participante-email').value,
                edad: parseInt(document.getElementById('participante-edad').value),
                sexo: document.getElementById('participante-sexo').value,
                fechaNacimiento: document.getElementById('participante-fecha-nacimiento').value,
                lugarNacimiento: document.getElementById('participante-lugar-nacimiento').value,
                parroquia: document.getElementById('participante-parroquia').value,
                direccion: document.getElementById('participante-direccion').value,
                discapacidad: document.getElementById('participante-discapacidad').value,
                discapacidadDetalle: document.getElementById('participante-discapacidad-detalle').value || '',
                tallaCamisa: document.getElementById('participante-talla-camisa').value,
                peso: document.getElementById('participante-peso').value,
                tallaPantalon: document.getElementById('participante-talla-pantalon').value,
                tallaZapato: document.getElementById('participante-talla-zapato').value,
                ocupacion: document.getElementById('participante-ocupacion').value,
                gradoInstruccion: document.getElementById('participante-grado-instruccion').value,
                formacionId: parseInt(document.getElementById('participante-formacion').value),
                docenteId: parseInt(document.getElementById('participante-docente').value),
                plantelId: parseInt(document.getElementById('participante-plantel').value),
                estado: 'activo'
            };

            // Verificar que la formación tenga vacantes
            const formacion = datosSistema.formaciones.find(f => f.id === participante.formacionId);
            if (formacion && formacion.vacantes <= 0) {
                showAlert('La formación seleccionada no tiene vacantes disponibles', 'error');
                return;
            }

            // Reducir vacantes de la formación
            if (formacion) {
                const formacionIndex = datosSistema.formaciones.findIndex(f => f.id === participante.formacionId);
                datosSistema.formaciones[formacionIndex].vacantes -= 1;
            }

            datosSistema.participantes.push(participante);
            guardarDatos();
            closeModal('modal-participante');
            cargarParticipantes();
            actualizarEstadisticas();
            showAlert('Participante guardado exitosamente', 'success');
        }

        function editarParticipante(id) {
            const participante = datosSistema.participantes.find(p => p.id === id);
            if (!participante) return;

            editandoId = id;
            document.getElementById('editar-participante-id').value = participante.id;
            document.getElementById('editar-participante-cedula').value = participante.cedula;
            document.getElementById('editar-participante-nombres').value = participante.nombres;
            document.getElementById('editar-participante-apellidos').value = participante.apellidos;
            document.getElementById('editar-participante-telefono').value = participante.telefono;
            document.getElementById('editar-participante-email').value = participante.email;
            document.getElementById('editar-participante-edad').value = participante.edad;
            document.getElementById('editar-participante-sexo').value = participante.sexo;
            document.getElementById('editar-participante-fecha-nacimiento').value = participante.fechaNacimiento;
            document.getElementById('editar-participante-lugar-nacimiento').value = participante.lugarNacimiento;
            document.getElementById('editar-participante-parroquia').value = participante.parroquia;
            document.getElementById('editar-participante-direccion').value = participante.direccion;
            document.getElementById('editar-participante-discapacidad').value = participante.discapacidad;
            document.getElementById('editar-participante-discapacidad-detalle').value = participante.discapacidadDetalle || '';
            document.getElementById('editar-participante-talla-camisa').value = participante.tallaCamisa || '';
            document.getElementById('editar-participante-peso').value = participante.peso || '';
            document.getElementById('editar-participante-talla-pantalon').value = participante.tallaPantalon || '';
            document.getElementById('editar-participante-talla-zapato').value = participante.tallaZapato || '';
            document.getElementById('editar-participante-ocupacion').value = participante.ocupacion || '';
            document.getElementById('editar-participante-grado-instruccion').value = participante.gradoInstruccion;

            // Mostrar detalle de discapacidad si es necesario
            toggleDiscapacidadEditar();

            // Llenar selects
            llenarSelectsParaEditarParticipante(participante);

            openModal('modal-editar-participante');
        }

        function llenarSelectsParaEditarParticipante(participante) {
            // Planteles
            const selectPlantel = document.getElementById('editar-participante-plantel');
            selectPlantel.innerHTML = '<option value="">Seleccionar Plantel</option>';
            datosSistema.planteles.forEach(plantel => {
                const option = document.createElement('option');
                option.value = plantel.id;
                option.textContent = plantel.nombre;
                if (plantel.id === participante.plantelId) {
                    option.selected = true;
                }
                selectPlantel.appendChild(option);
            });

            // Docentes del plantel seleccionado
            cargarDocentesYFormacionesEditar();
            
            // Formación actual
            const selectFormacion = document.getElementById('editar-participante-formacion');
            selectFormacion.innerHTML = '<option value="">Seleccionar Formación</option>';
            datosSistema.formaciones.forEach(formacion => {
                const option = document.createElement('option');
                option.value = formacion.id;
                option.textContent = formacion.nombre;
                if (formacion.id === participante.formacionId) {
                    option.selected = true;
                }
                selectFormacion.appendChild(option);
            });
        }

        function actualizarParticipante() {
            const id = editandoId;
            const index = datosSistema.participantes.findIndex(p => p.id === id);
            if (index === -1) return;

            const formacionAnterior = datosSistema.participantes[index].formacionId;
            const formacionNueva = parseInt(document.getElementById('editar-participante-formacion').value);

            // Si cambió de formación, ajustar vacantes
            if (formacionAnterior !== formacionNueva) {
                // Aumentar vacantes de la formación anterior
                if (formacionAnterior) {
                    const formacionAnteriorIndex = datosSistema.formaciones.findIndex(f => f.id === formacionAnterior);
                    if (formacionAnteriorIndex !== -1) {
                        datosSistema.formaciones[formacionAnteriorIndex].vacantes += 1;
                    }
                }

                // Reducir vacantes de la nueva formación
                const formacionNuevaObj = datosSistema.formaciones.find(f => f.id === formacionNueva);
                if (formacionNuevaObj && formacionNuevaObj.vacantes <= 0) {
                    showAlert('La formación seleccionada no tiene vacantes disponibles', 'error');
                    return;
                }
                
                if (formacionNuevaObj) {
                    const formacionNuevaIndex = datosSistema.formaciones.findIndex(f => f.id === formacionNueva);
                    datosSistema.formaciones[formacionNuevaIndex].vacantes -= 1;
                }
            }

            datosSistema.participantes[index] = {
                ...datosSistema.participantes[index],
                cedula: document.getElementById('editar-participante-cedula').value,
                nombres: document.getElementById('editar-participante-nombres').value,
                apellidos: document.getElementById('editar-participante-apellidos').value,
                telefono: document.getElementById('editar-participante-telefono').value,
                email: document.getElementById('editar-participante-email').value,
                edad: parseInt(document.getElementById('editar-participante-edad').value),
                sexo: document.getElementById('editar-participante-sexo').value,
                fechaNacimiento: document.getElementById('editar-participante-fecha-nacimiento').value,
                lugarNacimiento: document.getElementById('editar-participante-lugar-nacimiento').value,
                parroquia: document.getElementById('editar-participante-parroquia').value,
                direccion: document.getElementById('editar-participante-direccion').value,
                discapacidad: document.getElementById('editar-participante-discapacidad').value,
                discapacidadDetalle: document.getElementById('editar-participante-discapacidad-detalle').value || '',
                tallaCamisa: document.getElementById('editar-participante-talla-camisa').value,
                peso: document.getElementById('editar-participante-peso').value,
                tallaPantalon: document.getElementById('editar-participante-talla-pantalon').value,
                tallaZapato: document.getElementById('editar-participante-talla-zapato').value,
                ocupacion: document.getElementById('editar-participante-ocupacion').value,
                gradoInstruccion: document.getElementById('editar-participante-grado-instruccion').value,
                formacionId: formacionNueva,
                docenteId: parseInt(document.getElementById('editar-participante-docente').value),
                plantelId: parseInt(document.getElementById('editar-participante-plantel').value)
            };

            guardarDatos();
            closeModal('modal-editar-participante');
            cargarParticipantes();
            showAlert('Participante actualizado exitosamente', 'success');
        }

        function eliminarParticipante(id) {
            if (!confirm('¿Está seguro de eliminar este participante?')) return;
            
            const participante = datosSistema.participantes.find(p => p.id === id);
            if (participante && participante.formacionId) {
                // Aumentar vacantes de la formación
                const formacionIndex = datosSistema.formaciones.findIndex(f => f.id === participante.formacionId);
                if (formacionIndex !== -1) {
                    datosSistema.formaciones[formacionIndex].vacantes += 1;
                }
            }
            
            datosSistema.participantes = datosSistema.participantes.filter(p => p.id !== id);
            guardarDatos();
            cargarParticipantes();
            actualizarEstadisticas();
            showAlert('Participante eliminado exitosamente', 'success');
        }

        // FORMACIONES
        function cargarDocentesPorPlantelFormacion() {
            const plantelId = document.getElementById('formacion-plantel').value;
            const selectDocente = document.getElementById('formacion-docente');
            
            if (!plantelId) {
                selectDocente.innerHTML = '<option value="">Seleccionar Docente</option>';
                return;
            }

            // Cargar docentes del plantel
            selectDocente.innerHTML = '<option value="">Seleccionar Docente</option>';
            const docentesPlantel = datosSistema.docentes.filter(d => d.plantelId == plantelId);
            docentesPlantel.forEach(docente => {
                const option = document.createElement('option');
                option.value = docente.id;
                option.textContent = `${docente.nombres} ${docente.apellidos}`;
                selectDocente.appendChild(option);
            });
        }

        function cargarDocentesPorPlantelFormacionEditar() {
            const plantelId = document.getElementById('editar-formacion-plantel').value;
            const selectDocente = document.getElementById('editar-formacion-docente');
            
            if (!plantelId) {
                selectDocente.innerHTML = '<option value="">Seleccionar Docente</option>';
                return;
            }

            // Cargar docentes del plantel
            selectDocente.innerHTML = '<option value="">Seleccionar Docente</option>';
            const docentesPlantel = datosSistema.docentes.filter(d => d.plantelId == plantelId);
            docentesPlantel.forEach(docente => {
                const option = document.createElement('option');
                option.value = docente.id;
                option.textContent = `${docente.nombres} ${docente.apellidos}`;
                selectDocente.appendChild(option);
            });
        }

        function guardarFormacion() {
            // Cargar planteles en el select
            const selectPlantel = document.getElementById('formacion-plantel');
            selectPlantel.innerHTML = '<option value="">Seleccionar Plantel</option>';
            datosSistema.planteles.forEach(plantel => {
                const option = document.createElement('option');
                option.value = plantel.id;
                option.textContent = plantel.nombre;
                selectPlantel.appendChild(option);
            });

            const formacion = {
                id: generarId(datosSistema.formaciones),
                codigo: document.getElementById('formacion-codigo').value,
                nombre: document.getElementById('formacion-nombre').value,
                descripcion: document.getElementById('formacion-descripcion').value,
                duracion: parseInt(document.getElementById('formacion-duracion').value),
                modalidad: document.getElementById('formacion-modalidad').value,
                docenteId: parseInt(document.getElementById('formacion-docente').value),
                plantelId: parseInt(document.getElementById('formacion-plantel').value),
                fechaInicio: document.getElementById('formacion-fecha-inicio').value,
                fechaFin: document.getElementById('formacion-fecha-fin').value,
                vacantes: parseInt(document.getElementById('formacion-vacantes').value),
                estado: 'activa'
            };

            datosSistema.formaciones.push(formacion);
            guardarDatos();
            closeModal('modal-formacion');
            cargarFormaciones();
            actualizarEstadisticas();
            showAlert('Formación guardada exitosamente', 'success');
        }

        function editarFormacion(id) {
            const formacion = datosSistema.formaciones.find(f => f.id === id);
            if (!formacion) return;

            editandoId = id;
            document.getElementById('editar-formacion-id').value = formacion.id;
            document.getElementById('editar-formacion-codigo').value = formacion.codigo;
            document.getElementById('editar-formacion-nombre').value = formacion.nombre;
            document.getElementById('editar-formacion-descripcion').value = formacion.descripcion || '';
            document.getElementById('editar-formacion-duracion').value = formacion.duracion;
            document.getElementById('editar-formacion-modalidad').value = formacion.modalidad;
            document.getElementById('editar-formacion-fecha-inicio').value = formacion.fechaInicio;
            document.getElementById('editar-formacion-fecha-fin').value = formacion.fechaFin;
            document.getElementById('editar-formacion-vacantes').value = formacion.vacantes;

            // Llenar selects
            llenarSelectsParaEditarFormacion(formacion);

            openModal('modal-editar-formacion');
        }

        function llenarSelectsParaEditarFormacion(formacion) {
            // Planteles
            const selectPlantel = document.getElementById('editar-formacion-plantel');
            selectPlantel.innerHTML = '<option value="">Seleccionar Plantel</option>';
            datosSistema.planteles.forEach(plantel => {
                const option = document.createElement('option');
                option.value = plantel.id;
                option.textContent = plantel.nombre;
                if (plantel.id === formacion.plantelId) {
                    option.selected = true;
                }
                selectPlantel.appendChild(option);
            });

            // Docentes del plantel seleccionado
            cargarDocentesPorPlantelFormacionEditar();
            
            // Docente actual
            const selectDocente = document.getElementById('editar-formacion-docente');
            setTimeout(() => {
                if (selectDocente) {
                    selectDocente.value = formacion.docenteId;
                }
            }, 100);
        }

        function actualizarFormacion() {
            const id = editandoId;
            const index = datosSistema.formaciones.findIndex(f => f.id === id);
            if (index === -1) return;

            datosSistema.formaciones[index] = {
                ...datosSistema.formaciones[index],
                codigo: document.getElementById('editar-formacion-codigo').value,
                nombre: document.getElementById('editar-formacion-nombre').value,
                descripcion: document.getElementById('editar-formacion-descripcion').value,
                duracion: parseInt(document.getElementById('editar-formacion-duracion').value),
                modalidad: document.getElementById('editar-formacion-modalidad').value,
                docenteId: parseInt(document.getElementById('editar-formacion-docente').value),
                plantelId: parseInt(document.getElementById('editar-formacion-plantel').value),
                fechaInicio: document.getElementById('editar-formacion-fecha-inicio').value,
                fechaFin: document.getElementById('editar-formacion-fecha-fin').value,
                vacantes: parseInt(document.getElementById('editar-formacion-vacantes').value)
            };

            guardarDatos();
            closeModal('modal-editar-formacion');
            cargarFormaciones();
            showAlert('Formación actualizada exitosamente', 'success');
        }

        function eliminarFormacion(id) {
            if (!confirm('¿Está seguro de eliminar esta formación?')) return;
            
            // Verificar si hay participantes inscritos
            const tieneParticipantes = datosSistema.participantes.some(p => p.formacionId === id);
            if (tieneParticipantes) {
                showAlert('No se puede eliminar la formación porque tiene participantes inscritos', 'error');
                return;
            }
            
            datosSistema.formaciones = datosSistema.formaciones.filter(f => f.id !== id);
            guardarDatos();
            cargarFormaciones();
            actualizarEstadisticas();
            showAlert('Formación eliminada exitosamente', 'success');
        }

        // USUARIOS
        function cambiarTipoUsuario() {
            const plantelId = document.getElementById('usuario-plantel').value;
            const rol = document.getElementById('usuario-rol').value;
            const container = document.getElementById('usuario-entidad-container');
            const select = document.getElementById('usuario-entidad');
            const usernameInput = document.getElementById('usuario-username');
            
            if (!plantelId || !rol) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            let labelText = '';
            
            switch(rol) {
                case 'plantel':
                    labelText = 'Plantel';
                    usernameInput.value = datosSistema.planteles.find(p => p.id == plantelId)?.email || '';
                    break;
                case 'director':
                    labelText = 'Director';
                    break;
                case 'docente':
                    labelText = 'Docente';
                    break;
                case 'participante':
                    labelText = 'Participante';
                    break;
            }
            
            document.getElementById('usuario-entidad-label').textContent = `Seleccionar ${labelText}`;

            // Llenar select según el rol
            select.innerHTML = '<option value="">Seleccionar</option>';
            
            switch(rol) {
                case 'plantel':
                    const plantel = datosSistema.planteles.find(p => p.id == plantelId);
                    if (plantel) {
                        const option = document.createElement('option');
                        option.value = plantel.id;
                        option.textContent = plantel.nombre;
                        select.appendChild(option);
                    }
                    break;
                case 'director':
                    const directores = datosSistema.directores.filter(d => d.plantelId == plantelId);
                    directores.forEach(director => {
                        const option = document.createElement('option');
                        option.value = director.id;
                        option.textContent = `${director.nombres} ${director.apellidos}`;
                        select.appendChild(option);
                    });
                    break;
                case 'docente':
                    const docentes = datosSistema.docentes.filter(d => d.plantelId == plantelId);
                    docentes.forEach(docente => {
                        const option = document.createElement('option');
                        option.value = docente.id;
                        option.textContent = `${docente.nombres} ${docente.apellidos}`;
                        select.appendChild(option);
                    });
                    break;
                case 'participante':
                    const participantes = datosSistema.participantes.filter(p => p.plantelId == plantelId);
                    participantes.forEach(participante => {
                        const option = document.createElement('option');
                        option.value = participante.id;
                        option.textContent = `${participante.nombres} ${participante.apellidos}`;
                        select.appendChild(option);
                    });
                    break;
            }
        }

        function cambiarTipoUsuarioEditar() {
            const rol = document.getElementById('editar-usuario-rol').value;
            const container = document.getElementById('editar-usuario-entidad-container');
            const select = document.getElementById('editar-usuario-entidad');
            
            if (rol === 'admin') {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            document.getElementById('editar-usuario-entidad-label').textContent = 
                rol === 'plantel' ? 'Plantel' : 
                rol === 'director' ? 'Director' :
                rol === 'docente' ? 'Docente' : 'Participante';

            // Llenar select según el rol
            select.innerHTML = '<option value="">Seleccionar</option>';
            
            switch(rol) {
                case 'plantel':
                    datosSistema.planteles.forEach(plantel => {
                        const option = document.createElement('option');
                        option.value = plantel.id;
                        option.textContent = plantel.nombre;
                        select.appendChild(option);
                    });
                    break;
                case 'director':
                    datosSistema.directores.forEach(director => {
                        const option = document.createElement('option');
                        option.value = director.id;
                        option.textContent = `${director.nombres} ${director.apellidos}`;
                        select.appendChild(option);
                    });
                    break;
                case 'docente':
                    datosSistema.docentes.forEach(docente => {
                        const option = document.createElement('option');
                        option.value = docente.id;
                        option.textContent = `${docente.nombres} ${docente.apellidos}`;
                        select.appendChild(option);
                    });
                    break;
                case 'participante':
                    datosSistema.participantes.forEach(participante => {
                        const option = document.createElement('option');
                        option.value = participante.id;
                        option.textContent = `${participante.nombres} ${participante.apellidos}`;
                        select.appendChild(option);
                    });
                    break;
            }
        }

        function guardarUsuario() {
            const password = document.getElementById('usuario-password').value;
            const confirmPassword = document.getElementById('usuario-confirm-password').value;

            if (password !== confirmPassword) {
                showAlert('Las contraseñas no coinciden', 'error');
                return;
            }

            const plantelId = document.getElementById('usuario-plantel').value;
            const rol = document.getElementById('usuario-rol').value;
            const entidadId = document.getElementById('usuario-entidad').value;

            if (!plantelId || !rol || !entidadId) {
                showAlert('Por favor complete todos los campos', 'error');
                return;
            }

            let nombre = '';
            let username = document.getElementById('usuario-username').value;
            const email = document.getElementById('usuario-email').value;

            // Obtener nombre según la entidad
            switch(rol) {
                case 'plantel':
                    const plantel = datosSistema.planteles.find(p => p.id == entidadId);
                    nombre = plantel ? plantel.nombre : 'Plantel';
                    break;
                case 'director':
                    const director = datosSistema.directores.find(d => d.id == entidadId);
                    nombre = director ? `${director.nombres} ${director.apellidos}` : 'Director';
                    break;
                case 'docente':
                    const docente = datosSistema.docentes.find(d => d.id == entidadId);
                    nombre = docente ? `${docente.nombres} ${docente.apellidos}` : 'Docente';
                    break;
                case 'participante':
                    const participante = datosSistema.participantes.find(p => p.id == entidadId);
                    nombre = participante ? `${participante.nombres} ${participante.apellidos}` : 'Participante';
                    username = participante ? participante.cedula : username;
                    break;
            }

            const usuario = {
                id: generarId(datosSistema.usuarios),
                username: username,
                password: password,
                email: email,
                nombre: nombre,
                rol: rol,
                entidadId: parseInt(entidadId),
                estado: 'activo',
                ultimoAcceso: null
            };

            datosSistema.usuarios.push(usuario);
            guardarDatos();
            closeModal('modal-usuario');
            cargarUsuarios();
            showAlert('Usuario creado exitosamente', 'success');
        }

        function editarUsuario(id) {
            const usuario = datosSistema.usuarios.find(u => u.id === id);
            if (!usuario) return;

            editandoId = id;
            document.getElementById('editar-usuario-id').value = usuario.id;
            document.getElementById('editar-usuario-username').value = usuario.username;
            document.getElementById('editar-usuario-email').value = usuario.email;
            document.getElementById('editar-usuario-rol').value = usuario.rol;
            document.getElementById('editar-usuario-estado').value = usuario.estado;

            // Configurar entidad según el rol
            cambiarTipoUsuarioEditar();
            
            if (usuario.entidadId && usuario.rol !== 'admin') {
                const select = document.getElementById('editar-usuario-entidad');
                setTimeout(() => {
                    select.value = usuario.entidadId;
                }, 100);
            }

            openModal('modal-editar-usuario');
        }

        function actualizarUsuario() {
            const id = editandoId;
            const index = datosSistema.usuarios.findIndex(u => u.id === id);
            if (index === -1) return;

            const nuevaPassword = document.getElementById('editar-usuario-password').value;
            const confirmPassword = document.getElementById('editar-usuario-confirm-password').value;

            if (nuevaPassword && nuevaPassword !== confirmPassword) {
                showAlert('Las contraseñas no coinciden', 'error');
                return;
            }

            const usuarioActualizado = {
                ...datosSistema.usuarios[index],
                username: document.getElementById('editar-usuario-username').value,
                email: document.getElementById('editar-usuario-email').value,
                rol: document.getElementById('editar-usuario-rol').value,
                estado: document.getElementById('editar-usuario-estado').value,
                entidadId: document.getElementById('editar-usuario-entidad') ? 
                    parseInt(document.getElementById('editar-usuario-entidad').value) : null
            };

            if (nuevaPassword) {
                usuarioActualizado.password = nuevaPassword;
            }

            // Actualizar nombre según la entidad
            if (usuarioActualizado.entidadId) {
                switch(usuarioActualizado.rol) {
                    case 'plantel':
                        const plantel = datosSistema.planteles.find(p => p.id === usuarioActualizado.entidadId);
                        usuarioActualizado.nombre = plantel ? plantel.nombre : 'Plantel';
                        break;
                    case 'director':
                        const director = datosSistema.directores.find(d => d.id === usuarioActualizado.entidadId);
                        usuarioActualizado.nombre = director ? `${director.nombres} ${director.apellidos}` : 'Director';
                        break;
                    case 'docente':
                        const docente = datosSistema.docentes.find(d => d.id === usuarioActualizado.entidadId);
                        usuarioActualizado.nombre = docente ? `${docente.nombres} ${docente.apellidos}` : 'Docente';
                        break;
                    case 'participante':
                        const participante = datosSistema.participantes.find(p => p.id === usuarioActualizado.entidadId);
                        usuarioActualizado.nombre = participante ? `${participante.nombres} ${participante.apellidos}` : 'Participante';
                        break;
                }
            }

            datosSistema.usuarios[index] = usuarioActualizado;
            guardarDatos();
            closeModal('modal-editar-usuario');
            cargarUsuarios();
            showAlert('Usuario actualizado exitosamente', 'success');
        }

        function eliminarUsuario(id) {
            if (id === 1) {
                showAlert('No se puede eliminar el usuario administrador principal', 'error');
                return;
            }
            
            if (!confirm('¿Está seguro de eliminar este usuario?')) return;
            
            datosSistema.usuarios = datosSistema.usuarios.filter(u => u.id !== id);
            guardarDatos();
            cargarUsuarios();
            showAlert('Usuario eliminado exitosamente', 'success');
        }

        // ===== FUNCIONES DE INTERFACES =====
        function accederInterfaz(tipo) {
            if (tipo === 'plantel') {
                // Mostrar modal para seleccionar plantel
                openModal('modal-plantel-selector');
            } else {
                showAlert(`Seleccione un ${tipo} desde la sección correspondiente`, 'info');
            }
        }

        function accederInterfazDesdeAdmin(tipo, entidadId) {
            let usuarioTemp = null;
            
            switch(tipo) {
                case 'plantel':
                    const plantel = datosSistema.planteles.find(p => p.id === entidadId);
                    if (!plantel) {
                        showAlert('Plantel no encontrado', 'error');
                        return;
                    }
                    usuarioTemp = {
                        id: -1,
                        username: `plantel_${plantel.id}`,
                        password: 'temp123',
                        nombre: plantel.nombre,
                        rol: 'plantel',
                        entidadId: plantel.id,
                        email: plantel.email || '',
                        estado: 'activo',
                        ultimoAcceso: new Date().toISOString()
                    };
                    break;
                    
                case 'director':
                    const director = datosSistema.directores.find(d => d.id === entidadId);
                    if (!director) {
                        showAlert('Director no encontrado', 'error');
                        return;
                    }
                    usuarioTemp = {
                        id: -2,
                        username: director.email,
                        password: 'temp123',
                        nombre: `${director.nombres} ${director.apellidos}`,
                        rol: 'director',
                        entidadId: director.id,
                        email: director.email,
                        estado: 'activo',
                        ultimoAcceso: new Date().toISOString()
                    };
                    break;
                    
                case 'docente':
                    const docente = datosSistema.docentes.find(d => d.id === entidadId);
                    if (!docente) {
                        showAlert('Docente no encontrado', 'error');
                        return;
                    }
                    usuarioTemp = {
                        id: -3,
                        username: docente.email,
                        password: 'temp123',
                        nombre: `${docente.nombres} ${docente.apellidos}`,
                        rol: 'docente',
                        entidadId: docente.id,
                        email: docente.email,
                        estado: 'activo',
                        ultimoAcceso: new Date().toISOString()
                    };
                    break;
                    
                case 'participante':
                    const participante = datosSistema.participantes.find(p => p.id === entidadId);
                    if (!participante) {
                        showAlert('Participante no encontrado', 'error');
                        return;
                    }
                    usuarioTemp = {
                        id: -4,
                        username: participante.cedula,
                        password: 'temp123',
                        nombre: `${participante.nombres} ${participante.apellidos}`,
                        rol: 'participante',
                        entidadId: participante.id,
                        email: participante.email,
                        estado: 'activo',
                        ultimoAcceso: new Date().toISOString()
                    };
                    break;
            }
            
            if (usuarioTemp) {
                currentUser = usuarioTemp;
                currentRole = tipo;
                mostrarDashboard(tipo, usuarioTemp);
                showAlert(`Accediendo como ${tipo}`, 'info');
            }
        }

        function accederInterfazDesdeUsuario(usuarioId) {
            const usuario = datosSistema.usuarios.find(u => u.id === usuarioId);
            if (!usuario) {
                showAlert('Usuario no encontrado', 'error');
                return;
            }
            
            currentUser = usuario;
            currentRole = usuario.rol;
            mostrarDashboard(usuario.rol, usuario);
            showAlert(`Accediendo como ${usuario.nombre}`, 'info');
        }

        function volverAlAdmin() {
            // Ocultar todos los dashboards
            document.querySelectorAll('.dashboard-container').forEach(dash => {
                dash.classList.add('hidden');
            });
            
            // Mostrar admin dashboard
            document.getElementById('admin-dashboard').classList.remove('hidden');
            
            // Restaurar sesión de admin
            currentUser = datosSistema.usuarios.find(u => u.id === 1);
            currentRole = 'admin';
            
            // Recargar datos del admin
            actualizarEstadisticas();
            cargarPlanteles();
            cargarDirectores();
            cargarDocentes();
            cargarParticipantes();
            cargarFormaciones();
            cargarUsuarios();
            
            showAlert('Volviendo al panel de administración', 'info');
        }

        // ===== FUNCIONES DE UTILIDAD =====
        function showAlert(message, type = 'info', duration = 5000) {
            const alertContainer = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            alertContainer.appendChild(alert);

            setTimeout(() => {
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 300);
            }, duration);
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            // Limpiar formularios
            if (modalId.includes('modal-')) {
                const form = document.querySelector(`#${modalId} form`);
                if (form) form.reset();
            }
            editandoId = null;
        }

        function actualizarEstadisticas() {
            document.getElementById('stat-planteles').textContent = datosSistema.planteles.length;
            document.getElementById('stat-participantes').textContent = datosSistema.participantes.length;
            document.getElementById('stat-docentes').textContent = datosSistema.docentes.length;
            document.getElementById('stat-formaciones').textContent = datosSistema.formaciones.length;
        }

        function generarId(array) {
            return array.length > 0 ? Math.max(...array.map(item => item.id)) + 1 : 1;
        }

        function iniciarSincronizacionAutomatica() {
            const intervalo = datosSistema.configuracion.intervaloActualizacion * 1000;
            setInterval(() => {
                sincronizarDatos();
            }, intervalo);
        }

        function sincronizarDatos() {
            if (modoConexion === 'offline') {
                return;
            }

            // Guardar datos actualizados
            guardarDatos();
            
            // Actualizar interfaz actual
            actualizarInterfazActual();
        }

        function actualizarInterfazActual() {
            if (currentRole === 'admin') {
                const activeSection = document.querySelector('.content-section:not(.hidden)');
                if (activeSection) {
                    const sectionId = activeSection.id.replace('section-', '');
                    cargarSeccionAdmin(sectionId);
                }
            } else if (currentRole === 'plantel') {
                const activeSection = document.querySelector('.content-section:not(.hidden)');
                if (activeSection) {
                    const sectionId = activeSection.id.replace('section-', '');
                    cargarSeccionPlantel(sectionId);
                }
            } else if (currentRole === 'director') {
                const activeSection = document.querySelector('.content-section:not(.hidden)');
                if (activeSection) {
                    const sectionId = activeSection.id.replace('section-', '');
                    cargarSeccionDirector(sectionId);
                }
            } else if (currentRole === 'docente') {
                const activeSection = document.querySelector('.content-section:not(.hidden)');
                if (activeSection) {
                    const sectionId = activeSection.id.replace('section-', '');
                    cargarSeccionDocente(sectionId);
                }
            } else if (currentRole === 'participante') {
                const activeSection = document.querySelector('.content-section:not(.hidden)');
                if (activeSection) {
                    const sectionId = activeSection.id.replace('section-', '');
                    cargarSeccionParticipante(sectionId);
                }
            }
        }

        function logout() {
            // Limpiar usuario actual
            currentUser = null;
            currentRole = null;

            // Ocultar theme selector
            document.getElementById('theme-selector').classList.add('hidden');

            // Ocultar todos los dashboards
            document.querySelectorAll('.dashboard-container').forEach(dash => {
                dash.classList.add('hidden');
            });

            // Mostrar login
            document.getElementById('login-container').classList.remove('hidden');

            // Limpiar formulario de login
            document.getElementById('login-form').reset();

            showAlert('Sesión cerrada exitosamente', 'success');
        }

        function configurarModoConexion() {
            const statusElement = document.getElementById('connection-status');
            if (modoConexion === 'online') {
                statusElement.className = 'connection-status connection-online';
                statusElement.innerHTML = '<i class="fas fa-wifi"></i><span>Modo Online</span>';
                sincronizarDatos();
            } else {
                statusElement.className = 'connection-status connection-offline';
                statusElement.innerHTML = '<i class="fas fa-wifi-slash"></i><span>Modo Offline</span>';
            }
        }

        function repararSistema() {
            if (confirm('¿Está seguro de reparar el sistema? Esto puede tomar unos momentos.')) {
                showAlert('Reparando sistema...', 'info');
                
                // Verificar y reparar datos
                datosSistema.planteles = datosSistema.planteles || [];
                datosSistema.directores = datosSistema.directores || [];
                datosSistema.docentes = datosSistema.docentes || [];
                datosSistema.participantes = datosSistema.participantes || [];
                datosSistema.formaciones = datosSistema.formaciones || [];
                datosSistema.usuarios = datosSistema.usuarios || [];
                datosSistema.configuracion = datosSistema.configuracion || {
                    intervaloActualizacion: 5,
                    frecuenciaBackup: 'daily',
                    modoConexion: 'online'
                };

                // Asegurar que exista el usuario admin
                if (!datosSistema.usuarios.find(u => u.id === 1)) {
                    datosSistema.usuarios.unshift({
                        id: 1,
                        username: 'admin',
                        password: 'Perp.241',
                        email: 'pabloemiliorico24@gmail.com',
                        nombre: 'Administrador Principal',
                        rol: 'admin',
                        entidadId: null,
                        estado: 'activo',
                        ultimoAcceso: null
                    });
                }

                guardarDatos();
                showAlert('Sistema reparado exitosamente', 'success');
            }
        }

        function crearBackup() {
            const fecha = new Date().toISOString().replace(/[:.]/g, '-');
            const backupData = JSON.stringify(datosSistema, null, 2);
            const blob = new Blob([backupData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_complejo_virtual_epe_${fecha}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert('Backup creado exitosamente', 'success');
        }

        function crearBackupAutomatico() {
            const fecha = new Date().toISOString().split('T')[0];
            const backupKey = `backup_${fecha}`;
            localStorage.setItem(backupKey, JSON.stringify(datosSistema));
        }

        function cargarVersionAnterior() {
            const backups = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('backup_')) {
                    backups.push({
                        key: key,
                        fecha: key.replace('backup_', '')
                    });
                }
            }

            if (backups.length === 0) {
                showAlert('No hay backups disponibles', 'warning');
                return;
            }

            // Ordenar por fecha (más reciente primero)
            backups.sort((a, b) => b.fecha.localeCompare(a.fecha));
            
            const ultimoBackup = backups[0];
            const confirmacion = confirm(`¿Cargar backup del ${ultimoBackup.fecha}?`);
            
            if (confirmacion) {
                const datos = JSON.parse(localStorage.getItem(ultimoBackup.key));
                datosSistema = datos;
                guardarDatos();
                location.reload();
            }
        }

        function actualizarDesdeGitHub() {
            showAlert('Actualizando desde GitHub...', 'info');
            // Simular actualización desde GitHub
            setTimeout(() => {
                showAlert('Sistema actualizado correctamente desde GitHub', 'success');
            }, 2000);
        }

        function sincronizarGitHub() {
            showAlert('Sincronizando con GitHub...', 'info');
            // Aquí iría la lógica para sincronizar con GitHub
            setTimeout(() => {
                showAlert('Datos sincronizados con GitHub', 'success');
            }, 2000);
        }

        function guardarConfiguracion() {
            datosSistema.configuracion.intervaloActualizacion = 
                parseInt(document.getElementById('intervalo-sincronizacion').value) || 5;
            datosSistema.configuracion.frecuenciaBackup = 
                document.getElementById('frecuencia-backup').value || 'daily';
            
            guardarDatos();
            showAlert('Configuración guardada exitosamente', 'success');
        }

        function guardarPerfilAdmin() {
            const usuario = datosSistema.usuarios.find(u => u.id === 1);
            if (!usuario) return;

            const currentPassword = document.getElementById('admin-current-password').value;
            const newPassword = document.getElementById('admin-new-password').value;
            const confirmPassword = document.getElementById('admin-confirm-password').value;

            if (currentPassword && usuario.password !== currentPassword) {
                showAlert('Contraseña actual incorrecta', 'error');
                return;
            }

            if (newPassword && newPassword !== confirmPassword) {
                showAlert('Las contraseñas nuevas no coinciden', 'error');
                return;
            }

            usuario.nombre = document.getElementById('admin-profile-name').value;
            usuario.email = document.getElementById('admin-profile-email').value;
            
            if (newPassword) {
                usuario.password = newPassword;
            }

            guardarDatos();
            showAlert('Perfil actualizado exitosamente', 'success');
        }

        function inscribirseEnFormacion(formacionId) {
            const participanteId = currentUser.entidadId;
            const participanteIndex = datosSistema.participantes.findIndex(p => p.id === participanteId);
            
            if (participanteIndex === -1) {
                showAlert('Participante no encontrado', 'error');
                return;
            }

            const formacion = datosSistema.formaciones.find(f => f.id === formacionId);
            if (!formacion || formacion.vacantes <= 0) {
                showAlert('No hay vacantes disponibles en esta formación', 'error');
                return;
            }

            // Verificar si ya está inscrito
            if (datosSistema.participantes[participanteIndex].formacionId === formacionId) {
                showAlert('Ya está inscrito en esta formación', 'warning');
                return;
            }

            // Actualizar participante
            datosSistema.participantes[participanteIndex].formacionId = formacionId;
            datosSistema.participantes[participanteIndex].docenteId = formacion.docenteId;
            datosSistema.participantes[participanteIndex].plantelId = formacion.plantelId;

            // Reducir vacantes
            const formacionIndex = datosSistema.formaciones.findIndex(f => f.id === formacionId);
            datosSistema.formaciones[formacionIndex].vacantes -= 1;

            guardarDatos();
            showAlert('Inscripción realizada exitosamente', 'success');
            
            // Actualizar las secciones del participante
            cargarSeccionParticipante('mis-formaciones');
            cargarSeccionParticipante('inscribirse-formacion');
            cargarSeccionParticipante('dashboard-participante');
        }

        function darseDeBaja(participanteId, formacionId) {
            if (!confirm('¿Está seguro de darse de baja de esta formación?')) return;

            const participanteIndex = datosSistema.participantes.findIndex(p => p.id === participanteId);
            if (participanteIndex === -1) return;

            // Aumentar vacantes
            const formacionIndex = datosSistema.formaciones.findIndex(f => f.id === formacionId);
            if (formacionIndex !== -1) {
                datosSistema.formaciones[formacionIndex].vacantes += 1;
            }

            datosSistema.participantes[participanteIndex].formacionId = null;
            datosSistema.participantes[participanteIndex].docenteId = null;

            guardarDatos();
            showAlert('Se ha dado de baja exitosamente', 'success');
            
            // Actualizar las secciones del participante
            if (currentRole === 'participante' && currentUser.entidadId === participanteId) {
                cargarSeccionParticipante('mis-formaciones');
                cargarSeccionParticipante('inscribirse-formacion');
                cargarSeccionParticipante('dashboard-participante');
            }
        }

        // ===== GENERACIÓN DE CARNET =====
        function generarCarnet(participanteId) {
            const participante = datosSistema.participantes.find(p => p.id === participanteId);
            if (!participante) {
                showAlert('Participante no encontrado', 'error');
                return;
            }

            const formacion = datosSistema.formaciones.find(f => f.id === participante.formacionId);
            const plantel = datosSistema.planteles.find(p => p.id === participante.plantelId);
            const docente = datosSistema.docentes.find(d => d.id === participante.docenteId);

            const carnetContent = document.getElementById('carnet-content');
            carnetContent.innerHTML = `
                <div class="carnet-container">
                    <div class="carnet-header">
                        <h4>COMPLEJO VIRTUAL EPE</h4>
                        <p>Carnet de Participante</p>
                    </div>
                    <div class="carnet-photo">
                        <i class="fas fa-user" style="font-size: 2rem; color: #666;"></i>
                    </div>
                    <div class="carnet-info"><strong>Nombre:</strong> ${participante.nombres} ${participante.apellidos}</div>
                    <div class="carnet-info"><strong>Cédula:</strong> ${participante.cedula}</div>
                    <div class="carnet-info"><strong>Edad:</strong> ${participante.edad} años</div>
                    <div class="carnet-info"><strong>Formación:</strong> ${formacion ? formacion.nombre : 'No asignada'}</div>
                    <div class="carnet-info"><strong>Plantel:</strong> ${plantel ? plantel.nombre : 'No asignado'}</div>
                    <div class="carnet-info"><strong>Docente:</strong> ${docente ? docente.nombres + ' ' + docente.apellidos : 'No asignado'}</div>
                    <div class="carnet-qr" id="qr-code"></div>
                </div>
            `;

            // Generar QR
            const qrData = JSON.stringify({
                nombre: `${participante.nombres} ${participante.apellidos}`,
                cedula: participante.cedula,
                formacion: formacion ? formacion.nombre : '',
                plantel: plantel ? plantel.nombre : '',
                fecha: new Date().toLocaleDateString()
            });

            QRCode.toCanvas(document.getElementById('qr-code'), qrData, {
                width: 60,
                height: 60,
                margin: 1
            }, function(error) {
                if (error) console.error(error);
            });

            openModal('modal-carnet');
        }

        function descargarCarnet() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: [54, 86] // 5.4 x 8.6 cm
            });

            const participanteId = currentUser ? currentUser.entidadId : null;
            const participante = datosSistema.participantes.find(p => p.id === participanteId);
            
            if (!participante) {
                showAlert('No hay información de participante disponible', 'error');
                return;
            }

            const formacion = datosSistema.formaciones.find(f => f.id === participante.formacionId);
            const plantel = datosSistema.planteles.find(p => p.id === participante.plantelId);

            // Fondo del carnet
            doc.setFillColor(0, 0, 0);
            doc.rect(0, 0, 54, 86, 'F');
            
            // Encabezado
            doc.setFontSize(8);
            doc.setTextColor(255, 255, 255);
            doc.text('COMPLEJO VIRTUAL EPE', 27, 5, { align: 'center' });
            doc.text('CARNET DE PARTICIPANTE', 27, 8, { align: 'center' });

            // Foto (placeholder)
            doc.setFillColor(240, 240, 240);
            doc.rect(17, 12, 20, 25, 'F');
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(6);
            doc.text('FOTO', 27, 25, { align: 'center' });

            // Información
            doc.setFontSize(6);
            doc.text(`Nombre: ${participante.nombres} ${participante.apellidos}`, 5, 40);
            doc.text(`Cédula: ${participante.cedula}`, 5, 44);
            doc.text(`Edad: ${participante.edad} años`, 5, 48);
            doc.text(`Formación: ${formacion ? formacion.nombre : 'No asignada'}`, 5, 52);
            doc.text(`Plantel: ${plantel ? plantel.nombre : 'No asignado'}`, 5, 56);
            doc.text(`Fecha: ${new Date().toLocaleDateString()}`, 5, 60);

            // QR Code placeholder
            doc.setFillColor(255, 255, 255);
            doc.rect(34, 65, 15, 15, 'F');
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(4);
            doc.text('CÓDIGO QR', 41.5, 72, { align: 'center' });

            // Descargar PDF
            doc.save(`carnet_${participante.cedula}.pdf`);
            showAlert('Carnet descargado exitosamente', 'success');
        }

        function generarReportePDF(tipo) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            let datos = [];
            let titulo = '';
            
            switch(tipo) {
                case 'planteles':
                    datos = datosSistema.planteles;
                    titulo = 'Reporte de Planteles';
                    break;
                case 'participantes':
                    datos = datosSistema.participantes;
                    titulo = 'Reporte de Participantes';
                    break;
            }

            doc.setFontSize(16);
            doc.text(titulo, 10, 10);
            
            let y = 20;
            datos.forEach((item, index) => {
                if (y > 280) {
                    doc.addPage();
                    y = 10;
                }
                
                doc.setFontSize(10);
                doc.text(`${index + 1}. ${JSON.stringify(item, null, 2)}`, 10, y);
                y += 10;
            });

            doc.save(`reporte_${tipo}.pdf`);
            showAlert('Reporte PDF generado exitosamente', 'success');
        }

        function generarReporteExcel(tipo) {
            let datos = [];
            let nombreArchivo = '';
            
            switch(tipo) {
                case 'participantes':
                    datos = datosSistema.participantes.map(p => ({
                        'Cédula': p.cedula,
                        'Nombres': p.nombres,
                        'Apellidos': p.apellidos,
                        'Edad': p.edad,
                        'Email': p.email,
                        'Teléfono': p.telefono,
                        'Formación': datosSistema.formaciones.find(f => f.id === p.formacionId)?.nombre || 'No asignada',
                        'Plantel': datosSistema.planteles.find(pl => pl.id === p.plantelId)?.nombre || 'No asignado'
                    }));
                    nombreArchivo = 'participantes';
                    break;
            }

            const ws = XLSX.utils.json_to_sheet(datos);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Reporte");
            XLSX.writeFile(wb, `reporte_${nombreArchivo}.xlsx`);
            showAlert('Reporte Excel generado exitosamente', 'success');
        }

        function generarCarnetParticipante() {
            if (currentRole !== 'participante') {
                showAlert('Esta función solo está disponible para participantes', 'warning');
                return;
            }
            
            generarCarnet(currentUser.entidadId);
        }

        // ===== TEMAS =====
        function toggleThemeSelector() {
            const selector = document.getElementById('theme-selector');
            selector.classList.toggle('hidden');
        }

        function cambiarTema(tema) {
            const root = document.documentElement;
            
            switch(tema) {
                case 'blue-white':
                    root.style.setProperty('--primary-color', '#3498db');
                    root.style.setProperty('--secondary-color', '#2980b9');
                    root.style.setProperty('--bg-color', '#ffffff');
                    root.style.setProperty('--card-color', '#f8f9fa');
                    root.style.setProperty('--text-color', '#2c3e50');
                    root.style.setProperty('--text-secondary', '#7f8c8d');
                    root.style.setProperty('--border-color', '#dee2e6');
                    break;
                    
                case 'green-black':
                    root.style.setProperty('--primary-color', '#27ae60');
                    root.style.setProperty('--secondary-color', '#2ecc71');
                    root.style.setProperty('--bg-color', '#000000');
                    root.style.setProperty('--card-color', '#1a1a1a');
                    root.style.setProperty('--text-color', '#ffffff');
                    root.style.setProperty('--text-secondary', '#b0b0b0');
                    root.style.setProperty('--border-color', '#333333');
                    break;
                    
                case 'red-gray':
                    root.style.setProperty('--primary-color', '#e74c3c');
                    root.style.setProperty('--secondary-color', '#c0392b');
                    root.style.setProperty('--bg-color', '#2c3e50');
                    root.style.setProperty('--card-color', '#34495e');
                    root.style.setProperty('--text-color', '#ecf0f1');
                    root.style.setProperty('--text-secondary', '#bdc3c7');
                    root.style.setProperty('--border-color', '#7f8c8d');
                    break;
            }
            
            showAlert('Tema cambiado exitosamente', 'success');
        }
    </script>
    <!-- ===== PARCHE DE REPARACIÓN ===== -->
<script>
    // Parche de reparación para formularios y sincronización
    (function() {
        console.log('Iniciando parche de reparación...');
        
        // 1. PARCHE PARA SINCRONIZACIÓN AUTOMÁTICA
        let intervaloActual = null;
        
        function iniciarSincronizacionCorregida() {
            // Detener sincronización anterior si existe
            if (intervaloActual) {
                clearInterval(intervaloActual);
            }
            
            // Obtener intervalo de configuración
            const intervalo = (datosSistema?.configuracion?.intervaloActualizacion || 5) * 1000;
            
            console.log(`Iniciando sincronización automática cada ${intervalo/1000} segundos`);
            
            intervaloActual = setInterval(() => {
                console.log('Ejecutando sincronización automática...');
                sincronizarDatosCompleta();
            }, intervalo);
        }
        
        function sincronizarDatosCompleta() {
            try {
                // Guardar datos actuales
                guardarDatosCorregido();
                
                // Actualizar todas las interfaces activas
                actualizarTodasLasInterfaces();
                
                // Verificar conexión
                verificarConexion();
                
                console.log('Sincronización completada exitosamente');
            } catch (error) {
                console.error('Error en sincronización:', error);
                showAlert('Error en sincronización: ' + error.message, 'error');
            }
        }
        
        function guardarDatosCorregido() {
            try {
                // Validar estructura de datos
                datosSistema = datosSistema || {
                    planteles: [],
                    directores: [],
                    docentes: [],
                    participantes: [],
                    formaciones: [],
                    usuarios: [],
                    configuracion: {
                        intervaloActualizacion: 5,
                        frecuenciaBackup: 'daily',
                        modoConexion: 'online'
                    }
                };
                
                // Asegurar que todos los arrays existan
                datosSistema.planteles = datosSistema.planteles || [];
                datosSistema.directores = datosSistema.directores || [];
                datosSistema.docentes = datosSistema.docentes || [];
                datosSistema.participantes = datosSistema.participantes || [];
                datosSistema.formaciones = datosSistema.formaciones || [];
                datosSistema.usuarios = datosSistema.usuarios || [];
                
                // Validar cada array
                validarYRepararArray('planteles', ['id', 'nombre', 'codigoDependencia', 'codigoPlantel']);
                validarYRepararArray('directores', ['id', 'cedula', 'nombres', 'apellidos']);
                validarYRepararArray('docentes', ['id', 'cedula', 'nombres', 'apellidos', 'especialidad']);
                validarYRepararArray('participantes', ['id', 'cedula', 'nombres', 'apellidos']);
                validarYRepararArray('formaciones', ['id', 'codigo', 'nombre', 'duracion']);
                validarYRepararArray('usuarios', ['id', 'username', 'password', 'rol']);
                
                // Guardar en localStorage
                const datosSerializados = JSON.stringify(datosSistema, null, 2);
                localStorage.setItem('complejoVirtualEPE', datosSerializados);
                
                // Crear backup de seguridad
                crearBackupSeguridad();
                
                return true;
            } catch (error) {
                console.error('Error en guardarDatosCorregido:', error);
                showAlert('Error al guardar datos: ' + error.message, 'error');
                return false;
            }
        }
        
        function validarYRepararArray(nombreArray, camposRequeridos) {
            if (!datosSistema[nombreArray]) {
                datosSistema[nombreArray] = [];
                return;
            }
            
            // Filtrar elementos no nulos
            datosSistema[nombreArray] = datosSistema[nombreArray].filter(item => item != null);
            
            // Asegurar IDs únicos
            const idsVistos = new Set();
            datosSistema[nombreArray] = datosSistema[nombreArray].map((item, index) => {
                // Asegurar que el objeto existe
                if (!item || typeof item !== 'object') {
                    item = {};
                }
                
                // Asegurar ID único
                if (!item.id || idsVistos.has(item.id)) {
                    item.id = generarIdUnico(nombreArray);
                }
                idsVistos.add(item.id);
                
                // Asegurar campos requeridos
                camposRequeridos.forEach(campo => {
                    if (item[campo] === undefined || item[campo] === null) {
                        item[campo] = '';
                    }
                });
                
                return item;
            });
        }
        
        function generarIdUnico(arrayNombre) {
            const array = datosSistema[arrayNombre];
            let maxId = 0;
            array.forEach(item => {
                if (item && item.id && item.id > maxId) {
                    maxId = item.id;
                }
            });
            return maxId + 1;
        }
        
        function crearBackupSeguridad() {
            try {
                const fecha = new Date().toISOString().replace(/[:.]/g, '-');
                const backupData = JSON.stringify(datosSistema, null, 2);
                
                // Guardar en localStorage con timestamp
                const backupKey = `backup_seguridad_${fecha}`;
                localStorage.setItem(backupKey, backupData);
                
                // Mantener solo los últimos 5 backups
                limpiarBackupsAntiguos();
                
                return true;
            } catch (error) {
                console.error('Error creando backup:', error);
                return false;
            }
        }
        
        function limpiarBackupsAntiguos() {
            const backups = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('backup_seguridad_')) {
                    backups.push(key);
                }
            }
            
            // Ordenar por fecha (más antiguos primero)
            backups.sort();
            
            // Eliminar backups excedentes
            while (backups.length > 5) {
                const backupAntiguo = backups.shift();
                localStorage.removeItem(backupAntiguo);
            }
        }
        
        function actualizarTodasLasInterfaces() {
            try {
                // Actualizar estadísticas principales
                actualizarEstadisticasCorregidas();
                
                // Actualizar interfaz actual según rol
                if (currentRole) {
                    actualizarInterfazActualCorregida();
                }
                
                // Actualizar selects en formularios abiertos
                actualizarSelectsFormularios();
                
                return true;
            } catch (error) {
                console.error('Error actualizando interfaces:', error);
                return false;
            }
        }
        
        function actualizarEstadisticasCorregidas() {
            try {
                const stats = {
                    planteles: datosSistema.planteles?.length || 0,
                    directores: datosSistema.directores?.length || 0,
                    docentes: datosSistema.docentes?.length || 0,
                    participantes: datosSistema.participantes?.length || 0,
                    formaciones: datosSistema.formaciones?.length || 0
                };
                
                // Actualizar dashboard admin
                document.getElementById('stat-planteles')?.textContent = stats.planteles;
                document.getElementById('stat-participantes')?.textContent = stats.participantes;
                document.getElementById('stat-docentes')?.textContent = stats.docentes;
                document.getElementById('stat-formaciones')?.textContent = stats.formaciones;
                
                // Actualizar otras dashboards según sea necesario
                actualizarEstadisticasPorRol();
                
            } catch (error) {
                console.error('Error actualizando estadísticas:', error);
            }
        }
        
        function actualizarEstadisticasPorRol() {
            if (currentRole === 'plantel' && currentUser?.entidadId) {
                const plantelId = currentUser.entidadId;
                const directores = datosSistema.directores?.filter(d => d.plantelId === plantelId).length || 0;
                const docentes = datosSistema.docentes?.filter(d => d.plantelId === plantelId).length || 0;
                const participantes = datosSistema.participantes?.filter(p => p.plantelId === plantelId).length || 0;
                const formaciones = datosSistema.formaciones?.filter(f => f.plantelId === plantelId).length || 0;
                
                document.getElementById('stat-directores-plantel')?.textContent = directores;
                document.getElementById('stat-docentes-plantel')?.textContent = docentes;
                document.getElementById('stat-participantes-plantel')?.textContent = participantes;
                document.getElementById('stat-formaciones-plantel')?.textContent = formaciones;
            }
            // Agregar actualizaciones para otros roles aquí
        }
        
        function actualizarInterfazActualCorregida() {
            try {
                const seccionActiva = document.querySelector('.content-section:not(.hidden)');
                if (!seccionActiva) return;
                
                const seccionId = seccionActiva.id.replace('section-', '');
                
                switch(currentRole) {
                    case 'admin':
                        recargarSeccionAdmin(seccionId);
                        break;
                    case 'plantel':
                        recargarSeccionPlantel(seccionId);
                        break;
                    case 'director':
                        recargarSeccionDirector(seccionId);
                        break;
                    case 'docente':
                        recargarSeccionDocente(seccionId);
                        break;
                    case 'participante':
                        recargarSeccionParticipante(seccionId);
                        break;
                }
            } catch (error) {
                console.error('Error actualizando interfaz actual:', error);
            }
        }
        
        function recargarSeccionAdmin(seccionId) {
            switch(seccionId) {
                case 'planteles':
                    cargarPlanteles();
                    break;
                case 'directores':
                    cargarDirectores();
                    break;
                case 'docentes':
                    cargarDocentes();
                    break;
                case 'participantes':
                    cargarParticipantes();
                    break;
                case 'formaciones':
                    cargarFormaciones();
                    break;
                case 'usuarios':
                    cargarUsuarios();
                    break;
            }
        }
        
        function recargarSeccionPlantel(seccionId) {
            const plantelId = currentUser?.entidadId;
            if (!plantelId) return;
            
            switch(seccionId) {
                case 'docentes-plantel':
                    cargarDocentesPlantel(plantelId);
                    break;
                case 'participantes-plantel':
                    cargarParticipantesPlantel(plantelId);
                    break;
                case 'formaciones-plantel':
                    cargarFormacionesPlantel(plantelId);
                    break;
            }
        }
        
        function actualizarSelectsFormularios() {
            // Actualizar selects en modales abiertos
            const modalesAbiertos = document.querySelectorAll('.modal.active');
            modalesAbiertos.forEach(modal => {
                if (modal.id.includes('modal-')) {
                    actualizarSelectsModal(modal.id);
                }
            });
        }
        
        function actualizarSelectsModal(modalId) {
            switch(modalId) {
                case 'modal-usuario':
                case 'modal-editar-usuario':
                    actualizarSelectsUsuarios();
                    break;
                case 'modal-participante':
                case 'modal-editar-participante':
                    actualizarSelectsParticipantes();
                    break;
                case 'modal-formacion':
                case 'modal-editar-formacion':
                    actualizarSelectsFormaciones();
                    break;
            }
        }
        
        function actualizarSelectsUsuarios() {
            // Actualizar select de planteles en usuario
            const selectPlantel = document.getElementById('usuario-plantel') || 
                                 document.getElementById('editar-usuario-plantel');
            if (selectPlantel) {
                const plantelIdActual = selectPlantel.value;
                selectPlantel.innerHTML = '<option value="">Seleccionar Plantel</option>';
                datosSistema.planteles?.forEach(plantel => {
                    const option = document.createElement('option');
                    option.value = plantel.id;
                    option.textContent = plantel.nombre;
                    if (plantel.id == plantelIdActual) {
                        option.selected = true;
                    }
                    selectPlantel.appendChild(option);
                });
                
                // Disparar evento para cargar entidades
                selectPlantel.dispatchEvent(new Event('change'));
            }
        }
        
        function actualizarSelectsParticipantes() {
            // Actualizar select de planteles en participantes
            const selectsPlantel = [
                document.getElementById('participante-plantel'),
                document.getElementById('editar-participante-plantel')
            ].filter(Boolean);
            
            selectsPlantel.forEach(select => {
                const plantelIdActual = select.value;
                select.innerHTML = '<option value="">Seleccionar Plantel</option>';
                datosSistema.planteles?.forEach(plantel => {
                    const option = document.createElement('option');
                    option.value = plantel.id;
                    option.textContent = plantel.nombre;
                    if (plantel.id == plantelIdActual) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });
                
                // Disparar evento para cargar docentes y formaciones
                select.dispatchEvent(new Event('change'));
            });
        }
        
        function actualizarSelectsFormaciones() {
            // Actualizar select de planteles en formaciones
            const selectsPlantel = [
                document.getElementById('formacion-plantel'),
                document.getElementById('editar-formacion-plantel')
            ].filter(Boolean);
            
            selectsPlantel.forEach(select => {
                const plantelIdActual = select.value;
                select.innerHTML = '<option value="">Seleccionar Plantel</option>';
                datosSistema.planteles?.forEach(plantel => {
                    const option = document.createElement('option');
                    option.value = plantel.id;
                    option.textContent = plantel.nombre;
                    if (plantel.id == plantelIdActual) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });
                
                // Disparar evento para cargar docentes
                select.dispatchEvent(new Event('change'));
            });
        }
        
        function verificarConexion() {
            try {
                const statusElement = document.getElementById('connection-status');
                if (!statusElement) return;
                
                // Simular verificación de conexión
                const online = navigator.onLine;
                
                if (online && modoConexion === 'online') {
                    statusElement.className = 'connection-status connection-online';
                    statusElement.innerHTML = '<i class="fas fa-wifi"></i><span>Modo Online - Conectado</span>';
                } else if (!online || modoConexion === 'offline') {
                    statusElement.className = 'connection-status connection-offline';
                    statusElement.innerHTML = '<i class="fas fa-wifi-slash"></i><span>Modo Offline</span>';
                    
                    // Mostrar advertencia si estamos offline pero queremos online
                    if (!online && modoConexion === 'online') {
                        showAlert('No hay conexión a internet. Trabajando en modo offline.', 'warning');
                    }
                }
            } catch (error) {
                console.error('Error verificando conexión:', error);
            }
        }
        
        // 2. PARCHE PARA FORMULARIOS
        function aplicarParcheFormularios() {
            console.log('Aplicando parche a formularios...');
            
            // Interceptar todos los formularios de guardado
            const formularios = [
                'form-plantel', 'form-editar-plantel',
                'form-director', 'form-editar-director',
                'form-docente', 'form-editar-docente',
                'form-participante', 'form-editar-participante',
                'form-formacion', 'form-editar-formacion',
                'form-usuario', 'form-editar-usuario'
            ];
            
            formularios.forEach(formId => {
                const form = document.getElementById(formId);
                if (form) {
                    // Remover event listeners existentes para evitar duplicados
                    const nuevoForm = form.cloneNode(true);
                    form.parentNode.replaceChild(nuevoForm, form);
                    
                    // Agregar validación automática
                    agregarValidacionFormulario(formId);
                }
            });
            
            // Parche para selects que dependen de otros selects
            aplicarParcheSelectsDependientes();
            
            // Parche para campos obligatorios
            aplicarParcheCamposObligatorios();
        }
        
        function agregarValidacionFormulario(formId) {
            const form = document.getElementById(formId);
            if (!form) return;
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validar campos obligatorios
                if (!validarFormulario(form)) {
                    showAlert('Por favor complete todos los campos obligatorios', 'error');
                    return false;
                }
                
                // Validar datos específicos según formulario
                if (!validarDatosEspecificos(formId)) {
                    return false;
                }
                
                // Mostrar confirmación
                const confirmacion = confirm('¿Está seguro de guardar los datos?');
                if (!confirmacion) return false;
                
                // Ejecutar función de guardado correspondiente
                ejecutarGuardadoFormulario(formId);
                
                return false;
            });
        }
        
        function validarFormulario(form) {
            let valido = true;
            const camposRequeridos = form.querySelectorAll('[required]');
            
            camposRequeridos.forEach(campo => {
                if (!campo.value.trim()) {
                    campo.style.borderColor = '#e74c3c';
                    campo.style.boxShadow = '0 0 5px rgba(231, 76, 60, 0.5)';
                    valido = false;
                    
                    // Remover estilos después de 2 segundos
                    setTimeout(() => {
                        campo.style.borderColor = '';
                        campo.style.boxShadow = '';
                    }, 2000);
                } else {
                    campo.style.borderColor = '';
                    campo.style.boxShadow = '';
                }
            });
            
            return valido;
        }
        
        function validarDatosEspecificos(formId) {
            switch(formId) {
                case 'form-usuario':
                    return validarFormularioUsuario();
                case 'form-editar-usuario':
                    return validarFormularioEditarUsuario();
                case 'form-participante':
                    return validarFormularioParticipante();
                case 'form-editar-participante':
                    return validarFormularioEditarParticipante();
                default:
                    return true;
            }
        }
        
        function validarFormularioUsuario() {
            const password = document.getElementById('usuario-password')?.value;
            const confirmPassword = document.getElementById('usuario-confirm-password')?.value;
            
            if (password !== confirmPassword) {
                showAlert('Las contraseñas no coinciden', 'error');
                return false;
            }
            
            if (password.length < 6) {
                showAlert('La contraseña debe tener al menos 6 caracteres', 'error');
                return false;
            }
            
            return true;
        }
        
        function validarFormularioEditarUsuario() {
            const nuevaPassword = document.getElementById('editar-usuario-password')?.value;
            const confirmPassword = document.getElementById('editar-usuario-confirm-password')?.value;
            
            if (nuevaPassword && nuevaPassword !== confirmPassword) {
                showAlert('Las contraseñas no coinciden', 'error');
                return false;
            }
            
            return true;
        }
        
        function validarFormularioParticipante() {
            const edad = parseInt(document.getElementById('participante-edad')?.value || 0);
            if (edad < 16 || edad > 100) {
                showAlert('La edad debe estar entre 16 y 100 años', 'error');
                return false;
            }
            
            const cedula = document.getElementById('participante-cedula')?.value || '';
            if (!validarCedula(cedula)) {
                showAlert('La cédula no tiene un formato válido', 'error');
                return false;
            }
            
            return true;
        }
        
        function validarFormularioEditarParticipante() {
            const edad = parseInt(document.getElementById('editar-participante-edad')?.value || 0);
            if (edad < 16 || edad > 100) {
                showAlert('La edad debe estar entre 16 y 100 años', 'error');
                return false;
            }
            
            return true;
        }
        
        function validarCedula(cedula) {
            // Validación básica de cédula
            return /^\d{6,10}$/.test(cedula);
        }
        
        function ejecutarGuardadoFormulario(formId) {
            try {
                switch(formId) {
                    case 'form-plantel':
                        guardarPlantelCorregido();
                        break;
                    case 'form-editar-plantel':
                        actualizarPlantelCorregido();
                        break;
                    case 'form-director':
                        guardarDirectorCorregido();
                        break;
                    case 'form-editar-director':
                        actualizarDirectorCorregido();
                        break;
                    case 'form-docente':
                        guardarDocenteCorregido();
                        break;
                    case 'form-editar-docente':
                        actualizarDocenteCorregido();
                        break;
                    case 'form-participante':
                        guardarParticipanteCorregido();
                        break;
                    case 'form-editar-participante':
                        actualizarParticipanteCorregido();
                        break;
                    case 'form-formacion':
                        guardarFormacionCorregido();
                        break;
                    case 'form-editar-formacion':
                        actualizarFormacionCorregido();
                        break;
                    case 'form-usuario':
                        guardarUsuarioCorregido();
                        break;
                    case 'form-editar-usuario':
                        actualizarUsuarioCorregido();
                        break;
                }
                
                // Forzar sincronización inmediata
                sincronizarDatosCompleta();
                
            } catch (error) {
                console.error('Error ejecutando guardado:', error);
                showAlert('Error al guardar: ' + error.message, 'error');
            }
        }
        
        // Funciones de guardado corregidas
        function guardarPlantelCorregido() {
            const plantel = {
                id: generarId(datosSistema.planteles),
                codigoDependencia: document.getElementById('plantel-codigo-dependencia').value.trim(),
                codigoPlantel: document.getElementById('plantel-codigo-plantel').value.trim(),
                nombre: document.getElementById('plantel-nombre').value.trim(),
                direccion: document.getElementById('plantel-direccion').value.trim(),
                ciudad: document.getElementById('plantel-ciudad').value.trim(),
                telefono: document.getElementById('plantel-telefono').value.trim() || '',
                email: document.getElementById('plantel-email').value.trim() || '',
                estado: 'activo',
                fechaCreacion: new Date().toISOString()
            };

            datosSistema.planteles.push(plantel);
            guardarDatosCorregido();
            closeModal('modal-plantel');
            cargarPlanteles();
            actualizarEstadisticasCorregidas();
            showAlert('Plantel guardado exitosamente', 'success');
        }
        
        // Similar para las otras funciones de guardado...
        // [Nota: Se deben implementar funciones similares para cada entidad]
        
        function aplicarParcheSelectsDependientes() {
            // Parche para selects que dependen de otros selects
            const selectsDependientes = [
                { padre: 'participante-plantel', hijo: 'participante-docente' },
                { padre: 'participante-docente', hijo: 'participante-formacion' },
                { padre: 'editar-participante-plantel', hijo: 'editar-participante-docente' },
                { padre: 'editar-participante-docente', hijo: 'editar-participante-formacion' },
                { padre: 'formacion-plantel', hijo: 'formacion-docente' },
                { padre: 'editar-formacion-plantel', hijo: 'editar-formacion-docente' }
            ];
            
            selectsDependientes.forEach(({ padre, hijo }) => {
                const selectPadre = document.getElementById(padre);
                const selectHijo = document.getElementById(hijo);
                
                if (selectPadre && selectHijo) {
                    selectPadre.addEventListener('change', function() {
                        setTimeout(() => {
                            actualizarSelectDependiente(padre, hijo);
                        }, 100);
                    });
                }
            });
        }
        
        function actualizarSelectDependiente(padreId, hijoId) {
            const selectPadre = document.getElementById(padreId);
            const selectHijo = document.getElementById(hijoId);
            
            if (!selectPadre || !selectHijo) return;
            
            const valorPadre = selectPadre.value;
            
            // Limpiar select hijo
            selectHijo.innerHTML = '<option value="">Seleccionar...</option>';
            
            if (!valorPadre) return;
            
            // Llenar select hijo según la relación
            if (padreId.includes('plantel') && hijoId.includes('docente')) {
                const docentes = datosSistema.docentes?.filter(d => d.plantelId == valorPadre) || [];
                docentes.forEach(docente => {
                    const option = document.createElement('option');
                    option.value = docente.id;
                    option.textContent = `${docente.nombres} ${docente.apellidos}`;
                    selectHijo.appendChild(option);
                });
            } else if (padreId.includes('docente') && hijoId.includes('formacion')) {
                const formaciones = datosSistema.formaciones?.filter(f => f.docenteId == valorPadre && f.vacantes > 0) || [];
                formaciones.forEach(formacion => {
                    const option = document.createElement('option');
                    option.value = formacion.id;
                    option.textContent = formacion.nombre;
                    selectHijo.appendChild(option);
                });
            }
        }
        
        function aplicarParcheCamposObligatorios() {
            // Agregar indicador visual a campos obligatorios
            const camposRequeridos = document.querySelectorAll('[required]');
            camposRequeridos.forEach(campo => {
                const label = campo.closest('.form-group')?.querySelector('label');
                if (label && !label.innerHTML.includes('*')) {
                    label.innerHTML = label.innerHTML + ' <span style="color:#e74c3c">*</span>';
                }
            });
        }
        
        // 3. INICIALIZACIÓN DEL PARCHE
        function inicializarParche() {
            console.log('Inicializando parche de reparación...');
            
            // Esperar a que el DOM esté completamente cargado
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    ejecutarParche();
                });
            } else {
                ejecutarParche();
            }
        }
        
        function ejecutarParche() {
            // Aplicar parche a formularios
            aplicarParcheFormularios();
            
            // Reemplazar funciones originales con versiones corregidas
            reemplazarFuncionesOriginales();
            
            // Iniciar sincronización automática
            iniciarSincronizacionCorregida();
            
            // Agregar botón de reparación manual
            agregarBotonReparacion();
            
            console.log('Parche aplicado exitosamente');
            showAlert('Sistema optimizado y sincronización activada', 'success');
        }
        
        function reemplazarFuncionesOriginales() {
            // Guardar referencia a funciones originales
            if (window.guardarDatosOriginal === undefined) {
                window.guardarDatosOriginal = guardarDatos;
            }
            
            if (window.sincronizarDatosOriginal === undefined) {
                window.sincronizarDatosOriginal = sincronizarDatos;
            }
            
            // Reemplazar con versiones corregidas
            guardarDatos = guardarDatosCorregido;
            sincronizarDatos = sincronizarDatosCompleta;
            
            // Parche para funciones de guardado específicas
            parchearFuncionesGuardado();
        }
        
        function parchearFuncionesGuardado() {
            // Lista de funciones a parchear
            const funciones = [
                'guardarPlantel', 'actualizarPlantel',
                'guardarDirector', 'actualizarDirector',
                'guardarDocente', 'actualizarDocente',
                'guardarParticipante', 'actualizarParticipante',
                'guardarFormacion', 'actualizarFormacion',
                'guardarUsuario', 'actualizarUsuario'
            ];
            
            funciones.forEach(funcName => {
                if (window[funcName]) {
                    // Guardar original
                    window[funcName + 'Original'] = window[funcName];
                    
                    // Reemplazar con versión que incluye sincronización
                    window[funcName] = function(...args) {
                        const resultado = window[funcName + 'Original'](...args);
                        
                        // Forzar sincronización después del guardado
                        setTimeout(() => {
                            sincronizarDatosCompleta();
                        }, 100);
                        
                        return resultado;
                    };
                }
            });
        }
        
        function agregarBotonReparacion() {
            // Agregar botón de reparación manual en el dashboard admin
            const headerRight = document.querySelector('.dashboard-header .header-right');
            if (headerRight && !document.getElementById('btn-reparacion-manual')) {
                const btnReparacion = document.createElement('button');
                btnReparacion.id = 'btn-reparacion-manual';
                btnReparacion.className = 'btn btn-warning';
                btnReparacion.innerHTML = '<i class="fas fa-redo"></i> Reparar Ahora';
                btnReparacion.style.marginRight = '10px';
                
                btnReparacion.addEventListener('click', function() {
                    if (confirm('¿Ejecutar reparación manual del sistema?')) {
                        ejecutarReparacionManual();
                    }
                });
                
                headerRight.insertBefore(btnReparacion, headerRight.firstChild);
            }
        }
        
        function ejecutarReparacionManual() {
            showAlert('Iniciando reparación manual...', 'info');
            
            // 1. Validar y reparar estructura de datos
            const datosReparados = repararEstructuraDatos();
            
            // 2. Reconstruir índices y relaciones
            reconstruirRelaciones();
            
            // 3. Limpiar datos corruptos
            limpiarDatosCorruptos();
            
            // 4. Forzar sincronización completa
            sincronizarDatosCompleta();
            
            // 5. Recargar interfaces
            location.reload();
            
            showAlert('Reparación manual completada', 'success');
        }
        
        function repararEstructuraDatos() {
            console.log('Reparando estructura de datos...');
            
            // Asegurar que todos los arrays existan
            const arrays = ['planteles', 'directores', 'docentes', 'participantes', 'formaciones', 'usuarios'];
            arrays.forEach(array => {
                if (!datosSistema[array] || !Array.isArray(datosSistema[array])) {
                    datosSistema[array] = [];
                }
            });
            
            // Reparar configuración
            if (!datosSistema.configuracion) {
                datosSistema.configuracion = {
                    intervaloActualizacion: 5,
                    frecuenciaBackup: 'daily',
                    modoConexion: 'online'
                };
            }
            
            // Guardar datos reparados
            guardarDatosCorregido();
            
            return datosSistema;
        }
        
        function reconstruirRelaciones() {
            console.log('Reconstruyendo relaciones...');
            
            // Reconstruir relaciones entre entidades
            datosSistema.participantes?.forEach(participante => {
                if (participante.formacionId) {
                    const formacion = datosSistema.formaciones?.find(f => f.id === participante.formacionId);
                    if (formacion) {
                        participante.docenteId = formacion.docenteId;
                        participante.plantelId = formacion.plantelId;
                    }
                }
            });
            
            // Asegurar consistencia de vacantes
            datosSistema.formaciones?.forEach(formacion => {
                if (formacion.vacantes === undefined || formacion.vacantes < 0) {
                    formacion.vacantes = 10; // Valor por defecto
                }
            });
        }
        
        function limpiarDatosCorruptos() {
            console.log('Limpiando datos corruptos...');
            
            const arrays = ['planteles', 'directores', 'docentes', 'participantes', 'formaciones', 'usuarios'];
            
            arrays.forEach(array => {
                if (datosSistema[array]) {
                    // Filtrar elementos no válidos
                    datosSistema[array] = datosSistema[array].filter(item => 
                        item && typeof item === 'object' && item.id !== undefined
                    );
                    
                    // Eliminar duplicados por ID
                    const idsVistos = new Set();
                    datosSistema[array] = datosSistema[array].filter(item => {
                        if (idsVistos.has(item.id)) {
                            return false;
                        }
                        idsVistos.add(item.id);
                        return true;
                    });
                }
            });
        }
        
        // 4. MONITOREO Y LOGS
        function inicializarMonitoreo() {
            // Monitorear eventos de guardado
            window.addEventListener('beforeunload', function(e) {
                // Guardar datos antes de salir
                guardarDatosCorregido();
            });
            
            // Monitorear cambios en localStorage
            window.addEventListener('storage', function(e) {
                if (e.key === 'complejoVirtualEPE') {
                    console.log('Datos cambiados en otra pestaña, sincronizando...');
                    sincronizarDatosCompleta();
                }
            });
            
            // Monitorear conexión
            window.addEventListener('online', function() {
                console.log('Conexión restaurada');
                verificarConexion();
                sincronizarDatosCompleta();
            });
            
            window.addEventListener('offline', function() {
                console.log('Conexión perdida');
                verificarConexion();
            });
        }
        
        // Inicializar todo
        inicializarParche();
        inicializarMonitoreo();
        
        // Exportar funciones para depuración
        window.repararSistemaCompleto = ejecutarReparacionManual;
        window.verEstadoSincronizacion = function() {
            return {
                intervalo: intervaloActual ? 'Activo' : 'Inactivo',
                ultimaSincronizacion: new Date().toLocaleString(),
                datos: {
                    planteles: datosSistema.planteles?.length || 0,
                    directores: datosSistema.directores?.length || 0,
                    docentes: datosSistema.docentes?.length || 0,
                    participantes: datosSistema.participantes?.length || 0,
                    formaciones: datosSistema.formaciones?.length || 0,
                    usuarios: datosSistema.usuarios?.length || 0
                }
            };
        };
        
    })();
</script>
</body>
</html>
